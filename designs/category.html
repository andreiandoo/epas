<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categorie — Ambilet</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'sans': ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        'primary': '#A51C30',
                        'primary-dark': '#8B1728',
                        'secondary': '#1E293B',
                        'accent': '#E67E22',
                        'surface': '#F8FAFC',
                        'muted': '#64748B',
                        'border': '#E2E8F0',
                        'success': '#10B981',
                        'warning': '#F59E0B',
                        'error': '#EF4444',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="/assets/css/custom.css">
</head>
<body class="min-h-screen bg-surface font-sans">
    <!-- Header -->
    <div id="header-container"></div>

    <!-- Hero Section -->
    <section id="category-hero" class="bg-gradient-to-r from-primary to-primary-dark text-white py-16 lg:py-24">
        <div class="container mx-auto px-4">
            <div class="flex items-center gap-4 mb-4">
                <div id="category-icon" class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                </div>
                <div>
                    <h1 id="category-title" class="text-3xl lg:text-4xl font-extrabold">Categorie</h1>
                    <p id="category-description" class="text-white/80 mt-1">Descoperă cele mai bune evenimente</p>
                </div>
            </div>
            <p id="category-count" class="text-white/70"><span id="event-count">0</span> evenimente disponibile</p>
        </div>
    </section>

    <!-- Filters & Events -->
    <section class="container mx-auto px-4 py-8">
        <!-- Filters Bar -->
        <div class="bg-white rounded-2xl border border-border p-4 mb-8">
            <div class="flex flex-col lg:flex-row gap-4">
                <!-- Search -->
                <div class="flex-1">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Caută evenimente..." class="form-input pl-10 w-full">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                </div>

                <!-- City Filter -->
                <div class="w-full lg:w-48">
                    <select id="city-filter" class="form-select w-full">
                        <option value="">Toate orașele</option>
                    </select>
                </div>

                <!-- Date Filter -->
                <div class="w-full lg:w-48">
                    <select id="date-filter" class="form-select w-full">
                        <option value="">Oricând</option>
                        <option value="today">Astăzi</option>
                        <option value="tomorrow">Mâine</option>
                        <option value="this_week">Săptămâna aceasta</option>
                        <option value="this_month">Luna aceasta</option>
                        <option value="next_month">Luna viitoare</option>
                    </select>
                </div>

                <!-- Sort -->
                <div class="w-full lg:w-48">
                    <select id="sort-filter" class="form-select w-full">
                        <option value="date_asc">Dată (crescător)</option>
                        <option value="date_desc">Dată (descrescător)</option>
                        <option value="price_asc">Preț (crescător)</option>
                        <option value="price_desc">Preț (descrescător)</option>
                        <option value="popular">Popularitate</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Subcategories / Genres -->
        <div id="subcategories" class="flex flex-wrap gap-2 mb-8">
            <!-- Subcategories will be loaded here -->
        </div>

        <!-- Events Grid -->
        <div id="events-grid" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Events will be loaded here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-16">
            <div class="w-24 h-24 bg-muted/10 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-12 h-12 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-secondary mb-2">Nu am găsit evenimente</h3>
            <p class="text-muted mb-6">Încă nu există evenimente în această categorie sau filtrele selectate sunt prea restrictive.</p>
            <a href="/" class="btn btn-primary">Explorează toate evenimentele</a>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="text-center py-16">
            <div class="animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-muted">Se încarcă evenimentele...</p>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="hidden flex items-center justify-center gap-2 mt-12">
            <button onclick="prevPage()" id="prev-btn" class="btn btn-secondary" disabled>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Înapoi
            </button>
            <span class="px-4 py-2 text-muted">Pagina <span id="current-page">1</span> din <span id="total-pages">1</span></span>
            <button onclick="nextPage()" id="next-btn" class="btn btn-secondary">
                Înainte
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
    </section>

    <!-- All Categories Section -->
    <section class="bg-white border-t border-border py-12">
        <div class="container mx-auto px-4">
            <h2 class="text-2xl font-bold text-secondary mb-6">Toate Categoriile</h2>
            <div id="all-categories" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                <!-- Categories will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <div id="footer-container"></div>

    <script src="/assets/js/config.js"></script>
    <script src="/assets/js/api.js"></script>
    <script src="/assets/js/auth.js"></script>
    <script src="/assets/js/cart.js"></script>
    <script src="/assets/js/utils.js"></script>
    <script src="/assets/js/components/header.js"></script>
    <script src="/assets/js/components/footer.js"></script>
    <script src="/assets/js/components/event-card.js"></script>
    <script>
        let currentPage = 1;
        let totalPages = 1;
        let categorySlug = null;
        let categoryData = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Get category slug from URL
            const urlParams = new URLSearchParams(window.location.search);
            categorySlug = urlParams.get('slug') || urlParams.get('category');

            if (!categorySlug) {
                // If no category specified, show all categories
                loadAllCategoriesPage();
            } else {
                loadCategoryData();
            }

            loadCities();
            loadAllCategories();

            // Event listeners for filters
            document.getElementById('search-input').addEventListener('input', AmbiletUtils.debounce(filterEvents, 300));
            document.getElementById('city-filter').addEventListener('change', filterEvents);
            document.getElementById('date-filter').addEventListener('change', filterEvents);
            document.getElementById('sort-filter').addEventListener('change', filterEvents);
        });

        async function loadCategoryData() {
            try {
                const response = await AmbiletAPI.get(`/events/categories/${categorySlug}`);
                if (response.success) {
                    categoryData = response.data;
                    displayCategoryInfo(categoryData);
                    loadEvents();
                }
            } catch (error) {
                console.error('Error loading category:', error);
                loadMockCategoryData();
            }
        }

        function loadMockCategoryData() {
            const mockCategories = {
                'concerte': { name: 'Concerte', description: 'Concerte live și festivaluri de muzică', icon: 'music', color: 'primary' },
                'teatru': { name: 'Teatru', description: 'Spectacole de teatru și operă', icon: 'theater', color: 'accent' },
                'sport': { name: 'Sport', description: 'Evenimente sportive și competiții', icon: 'sport', color: 'success' },
                'standUp': { name: 'Stand-Up Comedy', description: 'Spectacole de comedie și umor', icon: 'comedy', color: 'warning' },
                'festivaluri': { name: 'Festivaluri', description: 'Festivaluri și evenimente în aer liber', icon: 'festival', color: 'primary' },
                'expozitii': { name: 'Expoziții', description: 'Expoziții de artă și muzee', icon: 'art', color: 'secondary' }
            };

            categoryData = mockCategories[categorySlug] || { name: 'Categorie', description: 'Evenimente în această categorie', icon: 'default', color: 'primary' };
            displayCategoryInfo(categoryData);
            loadMockEvents();
        }

        function displayCategoryInfo(data) {
            document.getElementById('category-title').textContent = data.name;
            document.getElementById('category-description').textContent = data.description || 'Descoperă cele mai bune evenimente';
            document.title = `${data.name} — Ambilet`;

            // Update hero color if specified
            if (data.color) {
                const hero = document.getElementById('category-hero');
                // Could update gradient based on category color
            }

            // Load subcategories if any
            if (data.genres || data.subcategories) {
                displaySubcategories(data.genres || data.subcategories);
            }
        }

        function displaySubcategories(items) {
            const container = document.getElementById('subcategories');
            if (!items || items.length === 0) {
                container.classList.add('hidden');
                return;
            }

            container.innerHTML = `
                <button class="px-4 py-2 bg-primary text-white rounded-full text-sm font-medium" data-genre="">
                    Toate
                </button>
                ${items.map(item => `
                    <button onclick="filterByGenre('${item.slug}')" class="px-4 py-2 bg-white border border-border hover:border-primary rounded-full text-sm font-medium text-secondary hover:text-primary transition-colors" data-genre="${item.slug}">
                        ${item.name}
                    </button>
                `).join('')}
            `;
        }

        function filterByGenre(genre) {
            // Update active button
            document.querySelectorAll('#subcategories button').forEach(btn => {
                if (btn.dataset.genre === genre) {
                    btn.classList.add('bg-primary', 'text-white', 'border-primary');
                    btn.classList.remove('bg-white', 'text-secondary', 'hover:text-primary');
                } else {
                    btn.classList.remove('bg-primary', 'text-white', 'border-primary');
                    btn.classList.add('bg-white', 'text-secondary', 'hover:text-primary');
                }
            });

            currentPage = 1;
            loadEvents(genre);
        }

        async function loadEvents(genre = null) {
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('events-grid').innerHTML = '';
            document.getElementById('empty-state').classList.add('hidden');

            const search = document.getElementById('search-input').value;
            const city = document.getElementById('city-filter').value;
            const date = document.getElementById('date-filter').value;
            const sort = document.getElementById('sort-filter').value;

            try {
                const params = new URLSearchParams({
                    category: categorySlug,
                    page: currentPage,
                    per_page: 12
                });

                if (genre) params.append('genre', genre);
                if (search) params.append('search', search);
                if (city) params.append('city', city);
                if (date) params.append('date_filter', date);
                if (sort) params.append('sort', sort);

                const response = await AmbiletAPI.get(`/events?${params.toString()}`);

                document.getElementById('loading-state').classList.add('hidden');

                if (response.success && response.data.events.length > 0) {
                    displayEvents(response.data.events);
                    updatePagination(response.data.pagination);
                    document.getElementById('event-count').textContent = response.data.pagination.total;
                } else {
                    showEmptyState();
                }
            } catch (error) {
                console.error('Error loading events:', error);
                loadMockEvents();
            }
        }

        function loadMockEvents() {
            document.getElementById('loading-state').classList.add('hidden');

            const mockEvents = [
                { id: 1, title: 'Concert Revelion 2025', slug: 'concert-revelion-2025', date: '2024-12-31', time: '21:00', venue: 'Sala Palatului', city: 'București', image: 'https://placehold.co/400x300/A51C30/FFFFFF?text=Concert', price_from: 150, category: 'Concerte' },
                { id: 2, title: 'Festival de Jazz', slug: 'festival-jazz', date: '2025-01-15', time: '19:00', venue: 'Opera Națională', city: 'Cluj-Napoca', image: 'https://placehold.co/400x300/E67E22/FFFFFF?text=Jazz', price_from: 80, category: 'Concerte' },
                { id: 3, title: 'Rock Night Live', slug: 'rock-night-live', date: '2025-01-20', time: '20:00', venue: 'Arenele Romane', city: 'București', image: 'https://placehold.co/400x300/1E293B/FFFFFF?text=Rock', price_from: 120, category: 'Concerte' },
                { id: 4, title: 'Symphony Orchestra', slug: 'symphony-orchestra', date: '2025-02-01', time: '19:30', venue: 'Ateneul Român', city: 'București', image: 'https://placehold.co/400x300/10B981/FFFFFF?text=Symphony', price_from: 200, category: 'Concerte' },
                { id: 5, title: 'Electronic Music Festival', slug: 'electronic-festival', date: '2025-02-14', time: '22:00', venue: 'Romexpo', city: 'București', image: 'https://placehold.co/400x300/8B5CF6/FFFFFF?text=Electronic', price_from: 90, category: 'Concerte' },
                { id: 6, title: 'Folk Music Night', slug: 'folk-night', date: '2025-02-20', time: '18:00', venue: 'Casa de Cultură', city: 'Sibiu', image: 'https://placehold.co/400x300/F59E0B/FFFFFF?text=Folk', price_from: 50, category: 'Concerte' },
            ];

            displayEvents(mockEvents);
            document.getElementById('event-count').textContent = mockEvents.length;
            document.getElementById('pagination').classList.add('hidden');
        }

        function displayEvents(events) {
            const container = document.getElementById('events-grid');
            container.innerHTML = events.map(event => AmbiletEventCard.render(event)).join('');
        }

        function showEmptyState() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('empty-state').classList.remove('hidden');
            document.getElementById('pagination').classList.add('hidden');
            document.getElementById('event-count').textContent = '0';
        }

        function updatePagination(pagination) {
            if (!pagination || pagination.last_page <= 1) {
                document.getElementById('pagination').classList.add('hidden');
                return;
            }

            document.getElementById('pagination').classList.remove('hidden');
            document.getElementById('current-page').textContent = pagination.current_page;
            document.getElementById('total-pages').textContent = pagination.last_page;
            totalPages = pagination.last_page;

            document.getElementById('prev-btn').disabled = pagination.current_page <= 1;
            document.getElementById('next-btn').disabled = pagination.current_page >= pagination.last_page;
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                loadEvents();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                loadEvents();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function filterEvents() {
            currentPage = 1;
            loadEvents();
        }

        async function loadCities() {
            try {
                const response = await AmbiletAPI.get('/events/cities');
                if (response.success) {
                    const select = document.getElementById('city-filter');
                    response.data.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city.slug;
                        option.textContent = city.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                // Add mock cities
                const select = document.getElementById('city-filter');
                ['București', 'Cluj-Napoca', 'Timișoara', 'Iași', 'Brașov', 'Sibiu'].forEach(city => {
                    const option = document.createElement('option');
                    option.value = city.toLowerCase().replace(' ', '-');
                    option.textContent = city;
                    select.appendChild(option);
                });
            }
        }

        async function loadAllCategories() {
            try {
                const response = await AmbiletAPI.get('/events/categories');
                if (response.success) {
                    displayAllCategories(response.data);
                }
            } catch (error) {
                displayAllCategories([
                    { slug: 'concerte', name: 'Concerte', icon: 'music', count: 45 },
                    { slug: 'teatru', name: 'Teatru', icon: 'theater', count: 23 },
                    { slug: 'sport', name: 'Sport', icon: 'sport', count: 18 },
                    { slug: 'standUp', name: 'Stand-Up', icon: 'comedy', count: 12 },
                    { slug: 'festivaluri', name: 'Festivaluri', icon: 'festival', count: 8 },
                    { slug: 'expozitii', name: 'Expoziții', icon: 'art', count: 15 }
                ]);
            }
        }

        function displayAllCategories(categories) {
            const container = document.getElementById('all-categories');
            container.innerHTML = categories.map(cat => `
                <a href="/category.html?slug=${cat.slug}" class="bg-surface rounded-xl p-4 hover:bg-primary/5 hover:border-primary border border-transparent transition-colors text-center ${categorySlug === cat.slug ? 'border-primary bg-primary/5' : ''}">
                    <div class="w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center mx-auto mb-3">
                        <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                    </div>
                    <h3 class="font-semibold text-secondary">${cat.name}</h3>
                    <p class="text-sm text-muted">${cat.count || 0} evenimente</p>
                </a>
            `).join('');
        }

        function loadAllCategoriesPage() {
            document.getElementById('category-title').textContent = 'Toate Categoriile';
            document.getElementById('category-description').textContent = 'Explorează evenimentele pe categorii';
            document.title = 'Categorii — Ambilet';
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('events-grid').classList.add('hidden');
            document.getElementById('category-count').classList.add('hidden');

            // Show all categories prominently
            loadAllCategories();
        }
    </script>
</body>
</html>
