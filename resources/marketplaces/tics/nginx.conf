
# =============================================================================
# CITY PAGES - Must be FIRST (before any /evenimente rules)
# =============================================================================

# City pages: /evenimente-bucuresti -> city.php?city=bucuresti
# This MUST be before the /evenimente exact match
location ~ "^/evenimente-([a-z0-9-]+)/?$" {
    rewrite ^/evenimente-([a-z0-9-]+)/?$ /city.php?city=$1 last;
}

# Redirect old city URLs to new format (301 permanent redirect)
location ~ "^/oras/([a-z0-9-]+)/?$" {
    return 301 /evenimente-$1;
}

# =============================================================================
# CATEGORY PAGES  (must be BEFORE venue /bilete- rule)
# =============================================================================

# Category pages: /bilete-la-concerte -> event-category.php?categorie=concerte
location ~ "^/bilete-la-([a-z0-9-]+)/?$" {
    rewrite ^/bilete-la-([a-z0-9-]+)/?$ /event-category.php?categorie=$1 last;
}

# =============================================================================
# VENUE PAGES
# =============================================================================

# Venue pages: /bilete-arena-nationala -> venue.php?venue=arena-nationala
location ~ "^/bilete-([a-z0-9-]+)/?$" {
    rewrite ^/bilete-([a-z0-9-]+)/?$ /venue.php?venue=$1 last;
}

# =============================================================================
# EVENT PAGES
# =============================================================================

# Short event URL: /e/coldplay-bucuresti-2026 -> event.php?slug=xxx
location ~ "^/e/([a-z0-9-]+)/?$" {
    rewrite ^/e/([a-z0-9-]+)/?$ /event.php?slug=$1 last;
}

# Event pages: /bilete/concert-coldplay-bucuresti -> event.php?fullslug=xxx
location ~ "^/bilete/([a-z0-9-]+)/?$" {
    rewrite ^/bilete/([a-z0-9-]+)/?$ /event.php?fullslug=$1 last;
}

# =============================================================================
# EVENTS LISTING
# =============================================================================

# Events listing: /evenimente (exact match)
location = /evenimente {
    rewrite ^ /events.php last;
}

# Events listing with trailing slash
location = /evenimente/ {
    rewrite ^ /events.php last;
}

# Events by category: /evenimente/concerte
location ~ "^/evenimente/([a-z0-9-]+)/?$" {
    rewrite ^/evenimente/([a-z0-9-]+)/?$ /events.php?categorie=$1 last;
}

# Category page: /categorie/concerte
location ~ "^/categorie/([a-z0-9-]+)/?$" {
    rewrite ^/categorie/([a-z0-9-]+)/?$ /event-category.php?categorie=$1 last;
}

# =============================================================================
# AUTH PAGES
# =============================================================================

location = /conectare {
    rewrite ^ /login.php last;
}

location = /inregistrare {
    rewrite ^ /register.php last;
}

location = /parola-uitata {
    rewrite ^ /forgot-password.php last;
}

# =============================================================================
# CART & CHECKOUT
# =============================================================================

location = /cos {
    rewrite ^ /cart.php last;
}

location = /checkout {
    rewrite ^ /checkout.php last;
}

# =============================================================================
# USER ACCOUNT PAGES
# =============================================================================

# User dashboard: /cont -> user/dashboard.php
location = /cont {
    rewrite ^ /user/dashboard.php last;
}
location = /cont/ {
    rewrite ^ /user/dashboard.php last;
}

# User tickets: /cont/bilete -> user/tickets.php
location ~ "^/cont/bilete/?$" {
    rewrite ^ /user/tickets.php last;
}

# User orders: /cont/comenzi -> user/orders.php
location ~ "^/cont/comenzi/?$" {
    rewrite ^ /user/orders.php last;
}

# User favorites: /cont/favorite -> user/favorites.php
location ~ "^/cont/favorite/?$" {
    rewrite ^ /user/favorites.php last;
}

# User rewards: /cont/puncte -> user/rewards.php
location ~ "^/cont/puncte/?$" {
    rewrite ^ /user/rewards.php last;
}

# User settings: /cont/setari -> user/settings.php
location ~ "^/cont/setari/?$" {
    rewrite ^ /user/settings.php last;
}

# User notifications: /cont/notificari -> user/notifications.php
location ~ "^/cont/notificari/?$" {
    rewrite ^ /user/notifications.php last;
}

# User logout
location = /deconectare {
    rewrite ^ /logout.php last;
}

# =============================================================================
# ORGANIZER PAGES
# =============================================================================

# Organizer dashboard: /organizator -> organizer/dashboard.php
location = /organizator {
    rewrite ^ /organizer/dashboard.php last;
}
location = /organizator/ {
    rewrite ^ /organizer/dashboard.php last;
}

# Organizer events list
location ~ "^/organizator/evenimente/?$" {
    rewrite ^ /organizer/events.php last;
}

# Organizer create event
location ~ "^/organizator/eveniment-nou/?$" {
    rewrite ^ /organizer/create-event.php last;
}

# Organizer edit event: /organizator/edit/{id}
location ~ "^/organizator/edit/([a-z0-9-]+)/?$" {
    rewrite ^/organizator/edit/([a-z0-9-]+)/?$ /organizer/event-edit.php?id=$1 last;
}

# Organizer event analytics: /organizator/analytics/{id}
location ~ "^/organizator/analytics/([a-z0-9-]+)/?$" {
    rewrite ^/organizator/analytics/([a-z0-9-]+)/?$ /organizer/analytics.php?id=$1 last;
}

# Organizer event report: /organizator/report/{id}
location ~ "^/organizator/report/([a-z0-9-]+)/?$" {
    rewrite ^/organizator/report/([a-z0-9-]+)/?$ /organizer/report.php?id=$1 last;
}

# Organizer event documents: /organizator/documents/{id}
location ~ "^/organizator/documents/([a-z0-9-]+)/?$" {
    rewrite ^/organizator/documents/([a-z0-9-]+)/?$ /organizer/documents.php?id=$1 last;
}

# Organizer event invitations: /organizator/invitations/{id}
location ~ "^/organizator/invitations/([a-z0-9-]+)/?$" {
    rewrite ^/organizator/invitations/([a-z0-9-]+)/?$ /organizer/invitations.php?id=$1 last;
}

# Organizer event sales: /organizator/sales/{id}
location ~ "^/organizator/sales/([a-z0-9-]+)/?$" {
    rewrite ^/organizator/sales/([a-z0-9-]+)/?$ /organizer/sales.php?id=$1 last;
}

# Organizer finance
location ~ "^/organizator/finante/?$" {
    rewrite ^ /organizer/finance.php last;
}

# Organizer payouts
location ~ "^/organizator/plati/?$" {
    rewrite ^ /organizer/payouts.php last;
}

# Organizer scanner
location ~ "^/organizator/scanner/?$" {
    rewrite ^ /organizer/scanner.php last;
}

# Organizer team
location ~ "^/organizator/echipa/?$" {
    rewrite ^ /organizer/team.php last;
}

# Organizer widget
location ~ "^/organizator/widget/?$" {
    rewrite ^ /organizer/widget.php last;
}

# Organizer settings
location ~ "^/organizator/setari/?$" {
    rewrite ^ /organizer/settings.php last;
}

# Organizer notifications
location ~ "^/organizator/notificari/?$" {
    rewrite ^ /organizer/notifications.php last;
}

# Organizer auth
location ~ "^/organizator/conectare/?$" {
    rewrite ^ /organizer/login.php last;
}
location ~ "^/organizator/inregistrare/?$" {
    rewrite ^ /organizer/register.php last;
}

# =============================================================================
# ARTIST PAGES
# =============================================================================

# Artists listing: /artisti
location = /artisti {
    rewrite ^ /artists.php last;
}
location = /artisti/ {
    rewrite ^ /artists.php last;
}

# Single artist page: /artist/carlas-dreams -> artist.php?slug=carlas-dreams
location ~ "^/artist/([a-z0-9-]+)/?$" {
    rewrite ^/artist/([a-z0-9-]+)/?$ /artist.php?slug=$1 last;
}

# =============================================================================
# STATIC PAGES
# =============================================================================

# About: /despre -> about.php
location = /despre {
    rewrite ^ /about.php last;
}

# Contact: /contact -> contact.php
location = /contact {
    rewrite ^ /contact.php last;
}

# FAQ: /faq -> faq.php
location = /faq {
    rewrite ^ /faq.php last;
}

# Partners: /parteneri -> partners.php
location = /parteneri {
    rewrite ^ /partners.php last;
}

# Past events: /evenimente-trecute -> past-events.php
location = /evenimente-trecute {
    rewrite ^ /past-events.php last;
}

# Checkout failed: /checkout/esuat -> checkout-failed.php
location = /checkout/esuat {
    rewrite ^ /checkout-failed.php last;
}

# Terms & conditions: /termeni -> termeni.php
location = /termeni {
    rewrite ^ /termeni.php last;
}

# Privacy policy: /confidentialitate -> confidentialitate.php
location = /confidentialitate {
    rewrite ^ /confidentialitate.php last;
}

# Refund policy: /retur -> rambursari.php
location = /retur {
    rewrite ^ /rambursari.php last;
}

# Order confirmation / thank you: /multumim -> thank-you.php
location = /multumim {
    rewrite ^ /thank-you.php last;
}

# =============================================================================
# BLOG PAGES
# =============================================================================

# Blog listing: /blog -> blog.php
location = /blog {
    rewrite ^ /blog.php last;
}
location = /blog/ {
    rewrite ^ /blog.php last;
}

# Blog category: /blog/categorie/{slug} -> blog-category.php?slug={slug}
location ~ "^/blog/categorie/([a-z0-9-]+)/?$" {
    rewrite ^/blog/categorie/([a-z0-9-]+)/?$ /blog-category.php?slug=$1 last;
}

# Blog single: /blog/{slug} -> blog-single.php?slug={slug}
location ~ "^/blog/([a-z0-9-]+)/?$" {
    rewrite ^/blog/([a-z0-9-]+)/?$ /blog-single.php?slug=$1 last;
}

# =============================================================================
# GENRE PAGES
# =============================================================================

# Genre page new URL: /gen/bilete-rock -> genre.php?slug=rock  (must be before generic /gen/ rule)
location ~ "^/gen/bilete-([a-z0-9-]+)/?$" {
    rewrite ^/gen/bilete-([a-z0-9-]+)/?$ /genre.php?slug=$1 last;
}

# Genre page: /gen/{slug} -> genre.php?slug={slug}
location ~ "^/gen/([a-z0-9-]+)/?$" {
    rewrite ^/gen/([a-z0-9-]+)/?$ /genre.php?slug=$1 last;
}

# =============================================================================
# HELP CENTER PAGES
# =============================================================================

# Help center: /centru-ajutor -> help-center.php
location = /centru-ajutor {
    rewrite ^ /help-center.php last;
}
location = /centru-ajutor/ {
    rewrite ^ /help-center.php last;
}

# Help single article: /centru-ajutor/{category}/{article}
location ~ "^/centru-ajutor/([a-z0-9-]+)/([a-z0-9-]+)/?$" {
    rewrite ^/centru-ajutor/([a-z0-9-]+)/([a-z0-9-]+)/?$ /help-single.php?category=$1&slug=$2 last;
}

# Help category: /centru-ajutor/{slug} -> help-category.php?slug={slug}
location ~ "^/centru-ajutor/([a-z0-9-]+)/?$" {
    rewrite ^/centru-ajutor/([a-z0-9-]+)/?$ /help-category.php?slug=$1 last;
}

# =============================================================================
# NEWSLETTER PAGES 
# =============================================================================

# Newsletter unsubscribe: /dezabonare -> newsletter-unsubscribe.php
location = /dezabonare {
    rewrite ^ /newsletter-unsubscribe.php last;
}

# Unsubscribed confirmation: /dezabonat -> unsubscribed.php
location = /dezabonat {
    rewrite ^ /unsubscribed.php last;
}

# =============================================================================
# SEARCH & VENUE CATEGORY
# =============================================================================

# Search results: /cauta -> search-results.php
location = /cauta {
    rewrite ^ /search-results.php last;
}

# Cities listing: /locatii -> locatii.php
location = /locatii {
    rewrite ^ /locatii.php last;
}
location = /locatii/ {
    rewrite ^ /locatii.php last;
}

# Venue category: /locatii/{slug} -> venue-category.php?slug={slug}
location ~ "^/locatii/([a-z0-9-]+)/?$" {
    rewrite ^/locatii/([a-z0-9-]+)/?$ /venue-category.php?slug=$1 last;
}

# =============================================================================
# API PROXY
# =============================================================================

# API endpoints - exclude .php files to prevent infinite rewrite loop
# The negative lookahead (?!.*\.php$) ensures proxy.php gets processed by PHP-FPM
location ~ "^/api/(?!.*\.php$)(.*)$" {
    rewrite ^/api/(.*)$ /api/proxy.php?endpoint=$1 last;
}

# =============================================================================
# ERROR PAGES
# =============================================================================

error_page 404 /404.php;
