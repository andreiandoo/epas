const AmbiletNotificationPoller=function(){let t=null,e=0,n=null,i=!1;const o="ambilet_last_notification_id";function a(){return localStorage.getItem(o)}function r(t){const e=document.getElementById("notification-badge"),n=document.getElementById("notification-count"),i=document.getElementById("notifications-list");if(!t)return;const o=t.total,a=t.notifications;e&&e.classList.toggle("hidden",0===o),n&&(n.textContent=`${o} noi`),i&&a.length>0?i.innerHTML=a.slice(0,5).map(t=>{const e={success:"bg-success/10 text-success",warning:"bg-warning/10 text-warning",danger:"bg-danger/10 text-danger",info:"bg-info/10 text-info",primary:"bg-primary/10 text-primary"},n=e[t.color]||e.primary;return`\n                    <a href="${t.action_url||"/organizator/notifications"}" onclick="AmbiletNotificationPoller.markAsRead(${t.id})" class="flex items-start gap-3 p-4 hover:bg-surface border-b border-border last:border-0 transition-colors ${t.is_read?"opacity-60":""}">\n                        <div class="w-8 h-8 ${n} rounded-full flex items-center justify-center flex-shrink-0">\n                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${i=t.type,{ticket_sale:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z",refund_request:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6",document_generated:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",service_order:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z",service_order_completed:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",payout_request:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"}[i]||"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"}"/>\n                            </svg>\n                        </div>\n                        <div class="flex-1 min-w-0">\n                            <p class="text-sm font-medium text-secondary truncate">${function(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}(t.title)}</p>\n                            <p class="text-xs text-muted mt-0.5">${t.time_ago}</p>\n                        </div>\n                        ${t.is_read?"":'<div class="w-2 h-2 bg-primary rounded-full flex-shrink-0 mt-2"></div>'}\n                    </a>\n                `;var i}).join(""):i&&0===a.length&&(i.innerHTML='<div class="p-6 text-center text-muted text-sm">Nu ai notificari noi</div>')}async function l(){const t=await async function(){try{if("undefined"==typeof AmbiletAPI)return null;const t=await AmbiletAPI.get("/organizer/notifications?per_page=5&read=0");if(t.success)return{notifications:t.data||[],total:t.meta?.total||0}}catch(t){console.warn("Failed to fetch notifications:",t)}return null}();if(!t)return;const i=t.notifications,l=t.total;if(i.length>0){const t=i[0].id,e=a();if(e&&t>parseInt(e)){const t=i[0];let e="default";"ticket_sale"===t.type?e="sale":"refund_request"===t.type?e="warning":"document_generated"!==t.type&&"service_order_completed"!==t.type||(e="success"),"undefined"!=typeof AmbiletNotificationSound&&AmbiletNotificationSound.play(e),"undefined"!=typeof AmbiletNotifications&&AmbiletNotifications.show(t.title,t.color||"info")}(c=t)&&(localStorage.setItem(o,String(c)),n=c)}var c;r(t),e=l}return{start:function(){t||(n=a(),l(),t=setInterval(l,3e4),i=!0)},stop:function(){t&&(clearInterval(t),t=null)},refresh:function(){l()},isActive:function(){return null!==t},markAsRead:function(t){if(t&&"undefined"!=typeof AmbiletAPI)try{AmbiletAPI.post("/organizer/notifications/"+t+"/read",{})}catch(t){}}}}();document.addEventListener("DOMContentLoaded",function(){localStorage.getItem("ambilet_organizer_data")&&setTimeout(function(){AmbiletNotificationPoller.start()},1e3)}),"undefined"!=typeof module&&module.exports&&(module.exports=AmbiletNotificationPoller);