const FeaturedCarousel={elements:{section:"featuredCarouselSection",track:"featuredCarouselTrack"},isDragging:!1,startX:0,scrollLeft:0,track:null,container:null,animationPaused:!1,initialized:!1,async init(e={}){if(this.initialized)return;const t=document.getElementById(this.elements.section),a=document.getElementById(this.elements.track);if(t&&a){this.initialized=!0,this.track=a,this.container=a.parentElement;try{const n=new URLSearchParams({type:"general",limit:12});e.category&&n.append("category",e.category),e.city&&n.append("city",e.city),e.genre&&n.append("genre",e.genre);const s=await AmbiletAPI.get("/events/featured?"+n.toString());let r=s.data?.events||(Array.isArray(s.data)?s.data:[]);const i=new Set,o=new Set;if(r=r.filter(e=>{const t=e.id,a=e.slug||"";return i.has(t)||a&&o.has(a)?(console.warn("[FeaturedCarousel] Duplicate event filtered:",{id:t,slug:a,name:e.name}),!1):(i.add(t),a&&o.add(a),!0)}),console.log("[FeaturedCarousel] Loaded",r.length,"unique events"),r.length>0){a.innerHTML="";const e=this.shuffleArray([...r]),n=e.map(e=>this.renderCard(e)).join("");if(e.length>=4)a.innerHTML=n+n;else{const t=Math.ceil(8/e.length);a.innerHTML=n.repeat(t)}t.classList.remove("hidden");const s=e.length,i=Math.max(20,4*s);a.style.animationDuration=i+"s",this.initDrag()}}catch(e){console.warn("Failed to load featured carousel:",e)}}},initDrag(){const e=this.track,t=this.container;e&&t&&(t.addEventListener("mousedown",e=>this.handleDragStart(e)),t.addEventListener("mousemove",e=>this.handleDragMove(e)),t.addEventListener("mouseup",()=>this.handleDragEnd()),t.addEventListener("mouseleave",()=>this.handleDragEnd()),t.addEventListener("touchstart",e=>this.handleDragStart(e),{passive:!0}),t.addEventListener("touchmove",e=>this.handleDragMove(e),{passive:!0}),t.addEventListener("touchend",()=>this.handleDragEnd()),e.querySelectorAll("a").forEach(e=>{e.addEventListener("dragstart",e=>e.preventDefault())}),t.style.cursor="grab")},handleDragStart(e){this.isDragging=!0,this.startX=e.type.includes("mouse")?e.pageX:e.touches[0].pageX;const t=window.getComputedStyle(this.track),a=new DOMMatrix(t.transform);this.scrollLeft=a.m41,this.track.style.animationPlayState="paused",this.animationPaused=!0,this.container.style.cursor="grabbing",document.body.style.userSelect="none"},handleDragMove(e){if(!this.isDragging)return;const t=1.5*((e.type.includes("mouse")?e.pageX:e.touches[0].pageX)-this.startX);this.track.style.animation="none",this.track.style.transform=`translateX(${this.scrollLeft+t}px)`},handleDragEnd(){if(!this.isDragging)return;this.isDragging=!1,this.container.style.cursor="grab",document.body.style.userSelect="";const e=window.getComputedStyle(this.track),t=new DOMMatrix(e.transform).m41,a=this.track.scrollWidth/2;let n=t%a;n>0&&(n-=a),this.track.style.transform="",this.track.style.animation="";const s=Math.abs(n)/a*50;this.track.style.animationDelay=`-${s/50*parseFloat(this.track.style.animationDuration||30)}s`,this.track.style.animationPlayState="running",this.animationPaused=!1},shuffleArray(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e},renderCard(e){const t=e.starts_at||e.date,a=t?new Date(t):new Date,n=a.getDate(),s=["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"][a.getMonth()],r=getStorageUrl(e.featured_image||e.image),i=e.name||e.title||"Eveniment",o=e.venue_name||(e.venue?e.venue.name:""),l=e.venue_city||(e.venue?e.venue.city:""),d=l?o?o+", "+l:l:o,c=e.price_from?"De la "+e.price_from+" lei":"",h=e.category?.name||e.category||"";return'<a href="/bilete/'+(e.slug||"")+'" class="featured-carousel-card group relative overflow-hidden rounded-2xl bg-white shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-1"><div class="relative h-48 overflow-hidden"><img src="'+r+'" alt="'+this.escapeHtml(i)+'" class="object-cover w-full h-full transition-transform duration-500 group-hover:scale-110" loading="lazy" width="300" height="192"><div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>'+(h?'<div class="absolute top-3 left-3"><span class="px-3 py-1 text-[10px] font-bold text-white uppercase bg-primary/90 backdrop-blur-sm rounded-full">'+this.escapeHtml(h)+"</span></div>":"")+'<div class="absolute bottom-3 right-3 bg-white/95 backdrop-blur-sm rounded-xl px-3 py-2 text-center shadow-lg"><div class="text-xl font-extrabold text-secondary leading-none">'+n+'</div><div class="text-xs font-semibold text-primary uppercase">'+s+'</div></div><div class="absolute top-3 right-3"><span class="flex items-center gap-1 px-2 py-1 text-[10px] font-bold text-white rounded-full bg-accent/90 backdrop-blur-sm"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg></span></div></div><div class="p-4"><h3 class="mb-2 font-bold leading-tight text-secondary line-clamp-2 group-hover:text-primary transition-colors">'+this.escapeHtml(i)+"</h3>"+(d?'<p class="flex items-center gap-1.5 mb-3 text-sm text-muted"><svg class="w-4 h-4 text-primary/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg><span class="truncate">'+this.escapeHtml(d)+"</span></p>":"")+'<div class="flex items-center justify-between pt-3 border-t border-border">'+(c?'<span class="text-sm font-bold text-primary">'+c+"</span>":"<span></span>")+'<span class="inline-flex items-center gap-1 text-sm font-semibold text-secondary group-hover:text-primary">Vezi<svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg></span></div></div></a>'},escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}};window.FeaturedCarousel=FeaturedCarousel;