const AmbiletSearch={isOpen:!1,searchTimeout:null,minChars:2,debounceMs:300,init(){this.bindEvents()},bindEvents(){const e=document.getElementById("searchBtn");e?.addEventListener("click",()=>this.open());const t=document.getElementById("searchCloseBtn");t?.addEventListener("click",()=>this.close());const s=document.getElementById("searchOverlay");s?.addEventListener("click",()=>this.close());const n=document.getElementById("searchInput");n?.addEventListener("input",e=>this.handleInput(e.target.value)),n?.addEventListener("keydown",e=>{"Escape"===e.key&&this.close(),"Enter"===e.key&&this.handleEnter(e.target.value)}),document.querySelectorAll(".search-suggestion").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.query;t&&n&&(n.value=t,this.handleInput(t))})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isOpen&&this.close()})},open(){const e=document.getElementById("searchContainer"),t=document.getElementById("searchOverlay"),s=document.getElementById("searchInput");e&&t&&(e.classList.remove("-translate-y-full"),t.classList.remove("opacity-0","invisible"),t.classList.add("opacity-100","visible"),this.isOpen=!0,setTimeout(()=>s?.focus(),100))},close(){const e=document.getElementById("searchContainer"),t=document.getElementById("searchOverlay"),s=document.getElementById("searchInput");e&&t&&(e.classList.add("-translate-y-full"),t.classList.add("opacity-0","invisible"),t.classList.remove("opacity-100","visible"),this.isOpen=!1,s&&(s.value=""),this.resetView())},handleInput(e){const t=e.trim();this.searchTimeout&&clearTimeout(this.searchTimeout);const s=document.getElementById("searchMinChars"),n=document.getElementById("searchQuickLinks"),d=document.getElementById("searchResults");if(0!==t.length){if(t.length<this.minChars)return s?.classList.remove("hidden"),n?.classList.add("hidden"),void d?.classList.add("hidden");s?.classList.add("hidden"),n?.classList.add("hidden"),d?.classList.remove("hidden"),this.showLoading(),this.searchTimeout=setTimeout(()=>{this.performSearch(t)},this.debounceMs)}else this.resetView()},handleEnter(e){const t=e.trim();t.length>=this.minChars&&(window.location.href=`/cauta?q=${encodeURIComponent(t)}`)},resetView(){const e=document.getElementById("searchMinChars"),t=document.getElementById("searchQuickLinks"),s=document.getElementById("searchResults"),n=document.getElementById("searchLoading"),d=document.getElementById("searchNoResults");e?.classList.add("hidden"),t?.classList.remove("hidden"),s?.classList.add("hidden"),n?.classList.add("hidden"),d?.classList.add("hidden")},showLoading(){const e=document.getElementById("searchLoading"),t=document.getElementById("searchNoResults"),s=document.getElementById("searchResultsContent"),n=document.getElementById("searchViewAll");e?.classList.remove("hidden"),t?.classList.add("hidden"),s?.classList.add("hidden"),n?.classList.add("hidden")},async performSearch(e){try{const t=await fetch(`/api/proxy.php?action=search&q=${encodeURIComponent(e)}&limit=5`),s=await t.json();s.success&&s.data?this.renderResults(e,s.data):this.showNoResults()}catch(e){console.error("Search error:",e),this.showNoResults()}},renderResults(e,t){const s=document.getElementById("searchLoading"),n=document.getElementById("searchNoResults"),d=document.getElementById("searchResultsContent"),a=document.getElementById("searchViewAll"),i=document.getElementById("searchViewAllLink");s?.classList.add("hidden");const c=t.events||[],r=t.artists||[],l=t.locations||[];0!==c.length+r.length+l.length?(d?.classList.remove("hidden"),n?.classList.add("hidden"),this.renderEventsSection(c),this.renderArtistsSection(r),this.renderLocationsSection(l),a&&i&&(a.classList.remove("hidden"),i.href=`/cauta?q=${encodeURIComponent(e)}`)):this.showNoResults()},showNoResults(){const e=document.getElementById("searchLoading"),t=document.getElementById("searchNoResults"),s=document.getElementById("searchResultsContent"),n=document.getElementById("searchViewAll");e?.classList.add("hidden"),t?.classList.remove("hidden"),s?.classList.add("hidden"),n?.classList.add("hidden")},renderEventsSection(e){const t=document.getElementById("searchEventsSection"),s=document.getElementById("searchEventsList"),n=document.getElementById("searchEventsCount");e.length?(t?.classList.remove("hidden"),n&&(n.textContent=`(${e.length})`),s&&(s.innerHTML=e.map(e=>this.renderEventItem(e)).join(""))):t?.classList.add("hidden")},renderEventItem(e){const t=e.start_date?this.formatDate(e.start_date):"",s=e.image||e.poster_url||"https://via.placeholder.com/80x80?text=Event",n=e.min_price?`de la ${e.min_price} lei`:"",d=e.venue?.name||e.venue_name||"";return`\n            <a href="/bilete/${e.slug}" class="flex gap-3 p-3 transition-all border border-transparent rounded-xl hover:bg-gray-50 hover:border-gray-200">\n                <div class="flex-shrink-0 w-16 h-16 overflow-hidden rounded-lg bg-gray-100">\n                    <img src="${s}" alt="${this.escapeHtml(e.title)}" class="object-cover w-full h-full" loading="lazy">\n                </div>\n                <div class="flex-1 min-w-0">\n                    <div class="text-sm font-semibold text-gray-900 truncate">${this.escapeHtml(e.title)}</div>\n                    <div class="text-xs text-gray-500 truncate">${t}${d?" â€¢ "+this.escapeHtml(d):""}</div>\n                    ${n?`<div class="text-xs font-semibold text-primary mt-1">${n}</div>`:""}\n                </div>\n            </a>\n        `},renderArtistsSection(e){const t=document.getElementById("searchArtistsSection"),s=document.getElementById("searchArtistsList"),n=document.getElementById("searchArtistsCount");e.length?(t?.classList.remove("hidden"),n&&(n.textContent=`(${e.length})`),s&&(s.innerHTML=e.map(e=>this.renderArtistItem(e)).join(""))):t?.classList.add("hidden")},renderArtistItem(e){const t=e.image||e.photo_url||"https://via.placeholder.com/80x80?text=Artist",s=e.genre||e.type||"";return`\n            <a href="/artist/${e.slug}" class="flex gap-3 p-3 transition-all border border-transparent rounded-xl hover:bg-gray-50 hover:border-gray-200">\n                <div class="flex-shrink-0 w-12 h-12 overflow-hidden rounded-full bg-gray-100">\n                    <img src="${t}" alt="${this.escapeHtml(e.name)}" class="object-cover w-full h-full" loading="lazy">\n                </div>\n                <div class="flex-1 min-w-0 flex flex-col justify-center">\n                    <div class="text-sm font-semibold text-gray-900 truncate">${this.escapeHtml(e.name)}</div>\n                    ${s?`<div class="text-xs text-gray-500 truncate">${this.escapeHtml(s)}</div>`:""}\n                </div>\n            </a>\n        `},renderLocationsSection(e){const t=document.getElementById("searchLocationsSection"),s=document.getElementById("searchLocationsList"),n=document.getElementById("searchLocationsCount");e.length?(t?.classList.remove("hidden"),n&&(n.textContent=`(${e.length})`),s&&(s.innerHTML=e.map(e=>this.renderLocationItem(e)).join(""))):t?.classList.add("hidden")},renderLocationItem(e){const t=e.image||"https://via.placeholder.com/80x80?text=Location",s=e.address||e.city||"";return`\n            <a href="/locatie/${e.slug}" class="flex gap-3 p-3 transition-all border border-transparent rounded-xl hover:bg-gray-50 hover:border-gray-200">\n                <div class="flex-shrink-0 w-12 h-12 overflow-hidden rounded-lg bg-gray-100">\n                    <img src="${t}" alt="${this.escapeHtml(e.name)}" class="object-cover w-full h-full" loading="lazy">\n                </div>\n                <div class="flex-1 min-w-0 flex flex-col justify-center">\n                    <div class="text-sm font-semibold text-gray-900 truncate">${this.escapeHtml(e.name)}</div>\n                    ${s?`<div class="text-xs text-gray-500 truncate">${this.escapeHtml(s)}</div>`:""}\n                </div>\n            </a>\n        `},formatDate(e){const t=new Date(e);return`${t.getDate()} ${["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]} ${t.getFullYear()}`},escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}};document.addEventListener("DOMContentLoaded",()=>{AmbiletSearch.init()});