const CityPage={city:"",cityData:null,page:1,perPage:24,totalPages:1,filters:{},monthNames:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],elements:{grid:"eventsGrid",pagination:"pagination",eventsCount:"eventsCount",categoryFilter:"categoryFilter",dateFilter:"dateFilter",priceFilter:"priceFilter",sortSelect:"sortSelect"},async init(e){if(this.city=e,!this.city)return void(window.location.href="/orase");await this.loadCityData()?await this.loadEvents():window.location.href="/orase"},async loadCityData(){try{const e=await AmbiletAPI.get("/locations/cities/"+encodeURIComponent(this.city));if(e.success&&e.data&&e.data.city){const t=e.data.city;return this.cityData=t,this.updatePageWithCityData(t),!0}return console.warn("City not found in API, using fallback"),!0}catch(e){return console.error("Failed to load city data:",e),!0}},updatePageWithCityData(e){document.title="Evenimente în "+e.name+" - AmBilet.ro";const t=e.cover_image||e.image;if(t){const n=document.querySelector("section.relative img");n&&(n.src=t,n.alt=e.name)}const n=document.querySelector("h1");n&&(n.textContent=e.name);const i=document.querySelector("section.relative p.text-lg");if(i){const t=e.region?"object"==typeof e.region?e.region.name:e.region:null;t?i.textContent="Descoperă cele mai bune evenimente din "+e.name+", "+t+".":e.description&&(i.textContent=e.description)}if(void 0!==e.events_count){const t=document.getElementById(this.elements.eventsCount);t&&(t.textContent=e.events_count+" evenimente disponibile")}},async loadEvents(){const e=document.getElementById(this.elements.grid);if(e){e.innerHTML=AmbiletEventCard.renderSkeletons(8);try{const t=new URLSearchParams({city:this.city,page:this.page,per_page:this.perPage,...this.filters}),n=await AmbiletAPI.get("/events?"+t.toString());if(n.data&&n.data.length>0){const t=this.groupEventsByMonth(n.data);let i="";if(t.forEach(e=>{i+=this.renderMonthGroup(e)}),e.innerHTML=i,e.classList.remove("grid"),e.classList.add("flex","flex-col","gap-8"),n.meta){const e=document.getElementById(this.elements.eventsCount);e&&(e.textContent=n.meta.total+" evenimente disponibile");const t=AmbiletPagination.normalize(n.meta);this.totalPages=t.totalPages,AmbiletPagination.render({containerId:this.elements.pagination,currentPage:t.currentPage,totalPages:t.totalPages,mode:"numbered",onPageChange:e=>this.goToPage(e)})}}else this.showEmptyState()}catch(e){console.error("Failed to load events:",e),this.showEmptyState()}}},showEmptyState(){const e=document.getElementById(this.elements.grid);e&&(e.innerHTML=AmbiletEmptyState.noEvents({onButtonClick:()=>this.clearFilters()}))},groupEventsByMonth(e){const t={};return e.forEach(e=>{const n=e.date||e.starts_at||e.range_start_date||e.event_date;if(!n)return;const i=new Date(n);if(isNaN(i.getTime()))return;const a=i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0"),s=this.monthNames[i.getMonth()]+" "+i.getFullYear();t[a]||(t[a]={key:a,label:s,events:[]}),t[a].events.push(e)}),Object.values(t).sort((e,t)=>e.key.localeCompare(t.key))},renderMonthGroup(e){const t=AmbiletEventCard.renderMany(e.events);return'<div class="month-group"><div class="flex items-center gap-4 mb-6"><h2 class="text-2xl font-bold text-gray-900">'+e.label+'</h2><span class="px-3 py-1 text-sm font-medium text-gray-600 bg-gray-100 rounded-full">'+e.events.length+" "+(1===e.events.length?"eveniment":"evenimente")+'</span><div class="flex-1 h-px bg-gray-200"></div></div><div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">'+t+"</div></div>"},filter(){const e=document.getElementById(this.elements.categoryFilter),t=document.getElementById(this.elements.dateFilter),n=document.getElementById(this.elements.priceFilter),i=document.getElementById(this.elements.sortSelect);this.filters={},e&&e.value&&(this.filters.category=e.value),t&&t.value&&(this.filters.date=t.value),n&&n.value&&(this.filters.price=n.value),i&&i.value&&(this.filters.sort=i.value),this.page=1,this.loadEvents()},clearFilters(){const e=document.getElementById(this.elements.categoryFilter),t=document.getElementById(this.elements.dateFilter),n=document.getElementById(this.elements.priceFilter),i=document.getElementById(this.elements.sortSelect);e&&(e.value=""),t&&(t.value=""),n&&(n.value=""),i&&(i.value="date"),this.filters={},this.page=1,this.loadEvents()},goToPage(e){this.page=e,this.loadEvents(),AmbiletPagination.scrollTo(400)}};window.CityPage=CityPage;