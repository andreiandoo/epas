const CategoryPage={category:"",currentPage:1,perPage:24,totalEvents:0,filters:{},monthNames:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],elements:{grid:"eventsGrid",pagination:"pagination",eventsCount:"eventsCount",citiesCount:"citiesCount",pageTitle:"pageTitle",pageDescription:"pageDescription",breadcrumbTitle:"breadcrumbTitle",categoryBanner:"categoryBanner",genresSection:"genresSection",genresPills:"genresPills",filterCity:"filterCity",filterDate:"filterDate",filterPrice:"filterPrice",sortEvents:"sortEvents",featuredSection:"featuredSection",featuredEvents:"featuredEvents",categoryFeaturedSection:"categoryFeaturedSection",categoryFeaturedEvents:"categoryFeaturedEvents"},async init(e){this.category=e||"",this.category&&(this.filters.category=this.category),await Promise.all([this.loadCategoryInfo(),this.loadGenres(),this.loadCities(),this.loadCategoryFeaturedEvents(),this.loadFeaturedEvents(),this.loadEvents()]),this.bindEvents()},async loadCategoryInfo(){if(this.category)try{const e=await AmbiletAPI.get("event-categories");if(e.data?.categories){const t=e.data.categories.find(e=>e.slug===this.category);if(t){const e=document.getElementById(this.elements.pageTitle),a=document.getElementById(this.elements.breadcrumbTitle),n=document.getElementById(this.elements.pageDescription),s=document.getElementById(this.elements.categoryBanner);e&&(e.innerHTML=(t.icon_emoji||"ðŸŽ«")+" "+t.name),a&&(a.textContent=t.name),n&&t.description&&(n.textContent=t.description),s&&t.image&&(s.src=t.image)}}}catch(e){console.warn("Failed to load category info:",e)}},async loadGenres(){const e=document.getElementById(this.elements.genresSection);if(this.category&&e)try{const t=await AmbiletAPI.get("/event-genres?category="+this.category),a=t.data?.genres||t.data||[];if(a.length>0){const e=document.getElementById(this.elements.genresPills);e&&(e.innerHTML='<button class="genre-pill active px-5 py-2.5 bg-white border border-border rounded-full font-medium text-sm transition-all" data-genre="">Toate</button>',a.forEach(t=>{e.innerHTML+='<a href="/gen/'+t.slug+'" class="genre-pill px-5 py-2.5 bg-white border border-border rounded-full font-medium text-sm transition-all hover:border-primary">'+t.name+"</a>"}))}else e.style.display="none"}catch(t){e.style.display="none"}else e&&(e.style.display="none")},async loadCities(){try{const e=this.category?"?category="+this.category:"",t=await AmbiletAPI.get("/events/cities"+e),a=t.data?.cities||(Array.isArray(t.data)?t.data:[]);if(a.length>0){const e='<option value="">Toate orasele</option>'+a.map(e=>'<option value="'+e.name+'">'+e.name+" ("+(e.event_count||0)+")</option>").join(""),t=document.getElementById(this.elements.filterCity);t&&(t.innerHTML=e);const n=document.getElementById("filterCityMobile");n&&(n.innerHTML=e);const s=document.getElementById(this.elements.citiesCount);s&&(s.textContent=a.length+" orase")}}catch(e){console.warn("Failed to load cities:",e)}},async loadCategoryFeaturedEvents(){const e=document.getElementById(this.elements.categoryFeaturedSection),t=document.getElementById(this.elements.categoryFeaturedEvents);if(e&&t&&this.category)try{const a=new URLSearchParams({type:"category",require_image:"true",category:this.category,limit:6}),n=await AmbiletAPI.get("/events/featured?"+a.toString()),s=n.data?.events||(Array.isArray(n.data)?n.data:[]);s.length>0?(e.classList.remove("hidden"),t.innerHTML=s.map(e=>this.renderCategoryFeaturedCard(e)).join("")):e.classList.add("hidden")}catch(t){console.warn("Failed to load category featured events:",t),e.classList.add("hidden")}},renderCategoryFeaturedCard(e){const t=e.starts_at||e.date,a=t?new Date(t):new Date,n=a.getDate(),s=["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"][a.getMonth()],i=["Dum","Lun","Mar","Mie","Joi","Vin","SÃ¢m"][a.getDay()],r=e.featured_image||e.image||"/assets/images/default-event.png",l=e.name||e.title||"Eveniment",o=e.venue_name||(e.venue?e.venue.name:""),d=e.venue_city||(e.venue?e.venue.city:""),c=d?o?o+", "+d:d:o,g=e.price_from?e.price_from+" lei":"";return'<a href="/bilete/'+(e.slug||"")+'" class="group relative block overflow-hidden transition-all duration-500 bg-white rounded-2xl hover:shadow-2xl hover:shadow-primary/20 hover:-translate-y-1"><div class="relative overflow-hidden aspect-[16/10]"><img src="'+r+'" alt="'+this.escapeHtml(l)+'" class="object-cover w-full h-full transition-transform duration-700 group-hover:scale-110" loading="lazy"><div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div><div class="absolute top-3 left-3"><span class="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-bold text-white uppercase rounded-full bg-gradient-to-r from-primary to-accent shadow-lg"><svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>Premium</span></div><div class="absolute bottom-3 right-3 bg-white/95 backdrop-blur-sm rounded-xl px-3 py-2 text-center shadow-lg transform transition-transform duration-300 group-hover:scale-105"><div class="text-xs font-medium text-primary uppercase">'+i+'</div><div class="text-xl font-extrabold text-secondary leading-none">'+n+'</div><div class="text-xs font-semibold text-muted uppercase">'+s+'</div></div></div><div class="p-5"><h3 class="mb-2 text-lg font-bold text-secondary line-clamp-2 group-hover:text-primary transition-colors">'+this.escapeHtml(l)+"</h3>"+(c?'<p class="flex items-center gap-1.5 mb-3 text-sm text-muted"><svg class="w-4 h-4 text-primary/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>'+this.escapeHtml(c)+"</p>":"")+'<div class="flex items-center justify-between pt-3 border-t border-border">'+(g?'<div class="text-sm text-muted">de la <span class="text-lg font-bold text-primary">'+g+"</span></div>":"<div></div>")+'<span class="inline-flex items-center gap-1 px-4 py-2 text-sm font-semibold text-white transition-all rounded-full bg-secondary group-hover:bg-primary group-hover:shadow-lg">CumpÄƒrÄƒ<svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg></span></div></div></a>'},async loadFeaturedEvents(){const e=document.getElementById(this.elements.featuredSection),t=document.getElementById(this.elements.featuredEvents);if(e&&t)try{const a=new URLSearchParams({type:"general",require_image:"true",limit:6});this.category&&a.append("category",this.category);const n=await AmbiletAPI.get("/events/featured?"+a.toString()),s=n.data?.events||(Array.isArray(n.data)?n.data:[]);s.length>0?(e.classList.remove("hidden"),t.innerHTML=s.map(e=>this.renderFeaturedCard(e)).join("")):e.classList.add("hidden")}catch(t){console.warn("Failed to load featured events:",t),e.classList.add("hidden")}},renderFeaturedCard(e){const t=e.starts_at||e.date,a=t?new Date(t):new Date,n=a.getDate(),s=["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"][a.getMonth()],i=e.featured_image||e.image||"/assets/images/default-event.png",r=e.name||e.title||"Eveniment",l=e.venue_name||(e.venue?e.venue.name:""),o=e.venue_city||(e.venue?e.venue.city:""),d=o?l?l+", "+o:o:l,c=e.price_from?"De la "+e.price_from+" lei":"",g=e.category?.name||e.category||"";return'<a href="/bilete/'+(e.slug||"")+'" class="group relative overflow-hidden rounded-2xl bg-secondary aspect-[16/9] md:aspect-[21/9]"><img src="'+i+'" alt="'+this.escapeHtml(r)+'" class="absolute inset-0 object-cover w-full h-full transition-transform duration-500 group-hover:scale-105" loading="lazy"><div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div><div class="absolute bottom-0 left-0 right-0 p-5"><div class="flex items-end justify-between"><div class="flex-1">'+(g?'<span class="inline-block px-3 py-1 mb-2 text-xs font-bold text-white uppercase rounded-full bg-primary">'+this.escapeHtml(g)+"</span>":"")+'<h3 class="mb-2 text-xl font-bold text-white md:text-2xl line-clamp-2">'+this.escapeHtml(r)+'</h3><div class="flex flex-wrap items-center gap-3 text-sm text-white/80"><span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>'+n+" "+s+"</span>"+(d?'<span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>'+this.escapeHtml(d)+"</span>":"")+"</div></div>"+(c?'<div class="flex-shrink-0 px-4 py-2 text-sm font-bold text-white rounded-xl bg-primary">'+c+"</div>":"")+'</div></div><div class="absolute top-4 right-4"><span class="flex items-center gap-1 px-3 py-1 text-xs font-bold text-white rounded-full bg-accent/90 backdrop-blur-sm"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>Recomandat</span></div></a>'},escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML},async loadEvents(){const e=document.getElementById(this.elements.grid);if(e){e.innerHTML=AmbiletEventCard.renderSkeletons(8);try{const t=document.getElementById(this.elements.sortEvents),a=new URLSearchParams({page:this.currentPage,per_page:this.perPage,sort:t?.value||"date_asc"});Object.keys(this.filters).forEach(e=>{this.filters[e]&&a.append(e,this.filters[e])});const n=await AmbiletAPI.get("/events?"+a.toString());if(n.data){const a=n.data,s=n.meta||{};this.totalEvents=s.total||a.length;const i=document.getElementById(this.elements.eventsCount);if(i&&(i.textContent=this.totalEvents+" evenimente"),a.length>0){const n=t?.value||"date_asc";if(n.startsWith("date_")){const t=this.groupEventsByMonth(a);"date_desc"===n&&t.reverse();let s="";t.forEach(e=>{s+=this.renderMonthGroup(e)}),e.innerHTML=s,e.classList.remove("grid"),e.classList.add("flex","flex-col","gap-8")}else e.innerHTML=a.map(e=>AmbiletEventCard.render(e)).join(""),e.classList.remove("flex","flex-col","gap-8"),e.classList.add("grid")}else e.innerHTML=AmbiletEmptyState.noEvents({onButtonClick:()=>this.clearFilters()});const r=AmbiletPagination.normalize(s);AmbiletPagination.render({containerId:this.elements.pagination,currentPage:r.currentPage,totalPages:r.totalPages,mode:"smart",onPageChange:e=>this.goToPage(e)})}}catch(t){console.error("Failed to load events:",t),e.innerHTML=AmbiletEmptyState.error({onButtonClick:()=>this.loadEvents()})}}},groupEventsByMonth(e){const t={};return e.forEach(e=>{const a=e.date||e.starts_at||e.event_date;if(!a)return;const n=new Date(a),s=n.getFullYear()+"-"+String(n.getMonth()+1).padStart(2,"0"),i=this.monthNames[n.getMonth()]+" "+n.getFullYear();t[s]||(t[s]={key:s,label:i,events:[]}),t[s].events.push(e)}),Object.values(t).sort((e,t)=>e.key.localeCompare(t.key))},renderMonthGroup(e){const t=e.events.map(e=>AmbiletEventCard.render(e)).join("");return'<div class="month-group"><div class="flex items-center gap-4 mb-6"><h2 class="text-2xl font-bold text-gray-900">'+e.label+'</h2><span class="px-3 py-1 text-sm font-medium text-gray-600 bg-gray-100 rounded-full">'+e.events.length+" "+(1===e.events.length?"eveniment":"evenimente")+'</span><div class="flex-1 h-px bg-gray-200"></div></div><div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">'+t+"</div></div>"},goToPage(e){this.currentPage=e,this.loadEvents(),AmbiletPagination.scrollTo(300)},bindEvents(){document.querySelectorAll(".genre-pill").forEach(e=>{e.addEventListener("click",e=>{"A"!==e.target.tagName&&(e.preventDefault(),document.querySelectorAll(".genre-pill").forEach(e=>e.classList.remove("active")),e.target.classList.add("active"),this.filters.genre=e.target.dataset.genre||"",this.currentPage=1,this.loadEvents())})});const e=document.getElementById(this.elements.filterCity),t=document.getElementById(this.elements.filterDate),a=document.getElementById(this.elements.filterPrice),n=document.getElementById(this.elements.sortEvents);e&&e.addEventListener("change",()=>this.applyFilters()),t&&t.addEventListener("change",()=>this.applyFilters()),a&&a.addEventListener("change",()=>this.applyFilters()),n&&n.addEventListener("change",()=>this.loadEvents())},applyFilters(){const e=document.getElementById(this.elements.filterCity)?.value,t=document.getElementById(this.elements.filterDate)?.value,a=document.getElementById(this.elements.filterPrice)?.value;if(e?this.filters.city=e:delete this.filters.city,t?this.filters.date_filter=t:delete this.filters.date_filter,a){const[e,t]=a.split("-");e?this.filters.min_price=e:delete this.filters.min_price,t?this.filters.max_price=t:delete this.filters.max_price}else delete this.filters.min_price,delete this.filters.max_price;this.currentPage=1,this.loadEvents()},clearFilters(){const e=document.getElementById(this.elements.filterCity),t=document.getElementById(this.elements.filterDate),a=document.getElementById(this.elements.filterPrice),n=document.getElementById(this.elements.sortEvents);e&&(e.value=""),t&&(t.value=""),a&&(a.value=""),n&&(n.value="date_asc"),document.querySelectorAll(".genre-pill").forEach(e=>e.classList.remove("active"));const s=document.querySelector('.genre-pill[data-genre=""]');s&&s.classList.add("active"),this.filters=this.category?{category:this.category}:{},this.currentPage=1,this.loadEvents()}};window.CategoryPage=CategoryPage;