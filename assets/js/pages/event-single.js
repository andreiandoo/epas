const EventPage={slug:"",event:null,quantities:{},ticketTypes:[],isInterested:!1,shareMenuOpen:!1,seatingLayout:null,selectedSeats:{},seatSelectionModal:null,sectionToTicketTypeMap:{},rowToTicketTypeMap:{},_colorPalette:["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#F97316"],getTicketTypeColor(e){if(e.color)return e.color;var t=this.ticketTypes.indexOf(e);if(t<0)for(var n=0;n<this.ticketTypes.length;n++)if(this.ticketTypes[n].id===e.id){t=n;break}return t<0&&(t=0),this._colorPalette[t%this._colorPalette.length]},calculateTicketCommission(e,t){if(e.commission&&e.commission.type){const n=e.commission;let s=0;switch(n.type){case"percentage":s=t*(n.rate/100);break;case"fixed":s=n.fixed||0;break;case"both":s=t*(n.rate/100)+(n.fixed||0)}return{amount:Math.round(100*s)/100,rate:n.rate||null,fixed:n.fixed||null,mode:n.mode||this.event.commission_mode||"included",type:n.type}}const n=this.event.commission_rate||5,s=this.event.commission_mode||"included",i=t*(n/100);return{amount:Math.round(100*i)/100,rate:n,fixed:null,mode:s,type:"percentage"}},elements:{loadingState:"loading-state",eventContent:"event-content",breadcrumbTitle:"breadcrumb-title",mainImage:"mainImage",eventBadges:"event-badges",eventTitle:"event-title",eventDay:"event-day",eventMonth:"event-month",eventWeekday:"event-weekday",eventDateFull:"event-date-full",eventTime:"event-time",eventDoors:"event-doors",venueName:"venue-name",venueAddress:"venue-address",venueLink:"venue-link",interestBtn:"interest-btn",interestIcon:"interest-icon",eventInterested:"event-interested",eventViews:"event-views",shareDropdown:"share-dropdown",shareMenu:"share-menu",eventDescription:"event-description",artistSection:"artist-section",artistContent:"artist-content",venue:"venue",venueContent:"venue-content",ticketTypes:"ticket-types",cartSummary:"cartSummary",emptyCart:"emptyCart",subtotal:"subtotal",taxesContainer:"taxesContainer",totalPrice:"totalPrice",pointsEarned:"pointsEarned",checkoutBtn:"checkoutBtn",customRelatedSection:"custom-related-section",customRelatedEvents:"custom-related-events",relatedEventsSection:"related-events-section",relatedCategoryText:"related-category-text",seeAllLink:"see-all-link",relatedEvents:"related-events",cartBadge:"cartBadge",cartDrawerCount:"cartDrawerCount"},async init(){const e=new URLSearchParams(window.location.search);this.slug=e.get("slug")||window.location.pathname.split("/bilete/")[1]?.split("?")[0]||"",this.isPreview="1"===e.get("preview"),this.slug?(await this.loadEvent(),this.updateHeaderCart(),this.trackView(),this.loadInterestStatus(),this.setupClickOutside()):window.location.href="/"},async trackView(){try{var e=await AmbiletAPI.trackEventView(this.slug);console.log("[EventPage] Track view response:",e)}catch(e){console.error("[EventPage] View tracking failed:",e)}},async loadInterestStatus(){if("undefined"==typeof AmbiletAuth||AmbiletAuth.isLoggedIn())try{var e=await AmbiletAPI.checkEventInterest(this.slug);console.log("[EventPage] Interest check response:",e),e.success&&e.data&&(this.isInterested=e.data.is_interested,this.updateInterestButton(),void 0!==e.data.views_count&&(document.getElementById(this.elements.eventViews).textContent=this.formatCount(e.data.views_count)+" vizualizÄƒri"))}catch(e){if(401===e.status||500===e.status||e.message&&e.message.includes("Auth"))return void console.log("[EventPage] Interest check skipped - user not authenticated");console.error("[EventPage] Interest check failed:",e)}else console.log("[EventPage] User not logged in, skipping interest check")},async toggleInterest(){if("undefined"==typeof AmbiletAuth||AmbiletAuth.isLoggedIn())try{var e=await AmbiletAPI.toggleEventInterest(this.slug);console.log("[EventPage] Toggle interest response:",e),e.success&&e.data&&(this.isInterested=e.data.is_interested,this.updateInterestButton())}catch(e){console.error("[EventPage] Toggle interest failed:",e),(401===e.status||500===e.status||e.message&&e.message.includes("Auth"))&&this.showLoginPrompt()}else this.showLoginPrompt()},showLoginPrompt(){var e=document.getElementById("login-prompt-modal");if(e)e.classList.remove("hidden");else{var t=document.createElement("div");t.id="login-prompt-modal",t.className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",t.innerHTML='<div class="w-full max-w-md p-6 bg-white shadow-2xl rounded-2xl"><div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 rounded-full bg-primary/10"><svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg></div><h3 class="mb-2 text-xl font-bold text-center text-secondary">Conecteaza-te pentru a salva</h3><p class="mb-6 text-center text-muted">Pentru a marca acest eveniment ca fiind de interes, trebuie sa fii conectat in contul tau.</p><div class="flex flex-col gap-3"><a href="/cont/autentificare" class="flex items-center justify-center w-full gap-2 px-6 py-3 font-semibold text-white transition-colors bg-primary rounded-xl hover:bg-primary-dark"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/></svg>Conecteaza-te</a><a href="/cont/inregistrare" class="flex items-center justify-center w-full gap-2 px-6 py-3 font-semibold transition-colors border-2 text-secondary rounded-xl border-border hover:border-primary hover:text-primary"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>Creeaza cont nou</a><button onclick="EventPage.closeLoginPrompt()" class="w-full px-6 py-3 font-medium transition-colors text-muted hover:text-secondary">Inchide</button></div></div>',t.addEventListener("click",function(e){e.target===t&&EventPage.closeLoginPrompt()}),document.body.appendChild(t)}},closeLoginPrompt(){var e=document.getElementById("login-prompt-modal");e&&e.classList.add("hidden")},updateInterestButton(){var e=document.getElementById(this.elements.interestBtn),t=document.getElementById(this.elements.interestIcon),n=document.getElementById(this.elements.eventInterested);this.isInterested?(e.classList.add("border-primary","text-primary","bg-primary/5"),t.setAttribute("fill","currentColor"),n.textContent="Trecut la favorite"):(e.classList.remove("border-primary","text-primary","bg-primary/5"),t.setAttribute("fill","none"),n.textContent="MÄƒ intereseazÄƒ")},formatCount:e=>e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,"")+"M":e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,"")+"k":String(e),toggleShareMenu(){var e=document.getElementById(this.elements.shareMenu);this.shareMenuOpen=!this.shareMenuOpen,e.classList.toggle("hidden",!this.shareMenuOpen)},setupClickOutside(){var e=this;document.addEventListener("click",function(t){var n=document.getElementById(e.elements.shareDropdown);n&&!n.contains(t.target)&&e.shareMenuOpen&&(e.shareMenuOpen=!1,document.getElementById(e.elements.shareMenu).classList.add("hidden"))})},shareOn(e){var t=window.location.href,n=this.event?this.event.title:document.title,s="";switch(e){case"facebook":s="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t);break;case"whatsapp":s="https://wa.me/?text="+encodeURIComponent(n+" - "+t);break;case"email":return s="mailto:?subject="+encodeURIComponent(n)+"&body="+encodeURIComponent("Uita-te la acest eveniment: "+t),window.location.href=s,void this.toggleShareMenu()}s&&window.open(s,"_blank","width=600,height=400"),this.toggleShareMenu()},async copyLink(){try{await navigator.clipboard.writeText(window.location.href);var e=document.querySelector('[onclick*="copyLink"]'),t=e.innerHTML;e.innerHTML='<svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copiat!',setTimeout(function(){e.innerHTML=t},2e3)}catch(e){console.error("Copy failed:",e)}this.toggleShareMenu()},async loadEvent(){try{const e=this.isPreview?{preview:!0}:{},t=await AmbiletAPI.getEvent(this.slug,e);console.log("[EventPage] API Response:",t),console.log("[EventPage] === EVENT DATA ==="),console.log("[EventPage] Event object:",t.data?.event),console.log("[EventPage] TARGET_PRICE:",t.data?.event?.target_price),console.log("[EventPage] === TAXES ==="),console.log("[EventPage] Taxes from API:",t.data?.taxes),console.log("[EventPage] === TICKET TYPES ==="),console.log("[EventPage] Ticket types from API:",t.data?.ticket_types),t.success&&t.data?(this.event=this.transformApiData(t.data),console.log("[EventPage] Transformed event:",this.event),console.log("[EventPage] Transformed target_price:",this.event.target_price),console.log("[EventPage] Event taxes:",this.event.taxes),console.log("[EventPage] Event ticket_types:",this.ticketTypes),this.render(),this.event.organizer&&this.event.organizer.id&&this.loadOrganizerTracking(this.event.organizer.id)):this.showError("Eveniment negÄƒsit")}catch(e){console.error("Failed to load event:",e),404===e.status?this.showError("Eveniment negÄƒsit"):this.showError("Eroare la Ã®ncÄƒrcarea evenimentului")}},transformApiData(e){var t=e.event||e,n=e.venue||null,s=e.artists||[],i=e.ticket_types||[],a=t.starts_at?new Date(t.starts_at):new Date,o=t.doors_open_at?new Date(t.doors_open_at):null;function r(e){return e?String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0"):null}var l=t.poster_url||t.image_url||null,d=t.hero_image_url||t.cover_image_url||t.image_url||null;return{id:t.id,title:t.name,slug:t.slug,description:t.description,content:t.description,short_description:t.short_description,image:d||l,posterImage:l,heroImage:d,images:[d,l].filter(Boolean).filter(function(e,t,n){return n.indexOf(e)===t}),category:t.category,category_slug:t.category_slug||(t.category?t.category.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-"):null),tags:t.tags,duration_mode:t.duration_mode||"single_day",start_date:t.starts_at,date:t.starts_at,end_date:t.ends_at,range_start_date:t.range_start_date,range_end_date:t.range_end_date,range_start_time:t.range_start_time,range_end_time:t.range_end_time,multi_slots:t.multi_slots,start_time:r(a),doors_time:r(o),is_popular:t.is_featured,is_featured:t.is_featured,interested_count:t.interested_count||0,views_count:t.views_count||0,is_sold_out:t.is_sold_out||!1,is_cancelled:t.is_cancelled||!1,cancel_reason:t.cancel_reason||null,is_postponed:t.is_postponed||!1,postponed_reason:t.postponed_reason||null,postponed_date:t.postponed_date||null,postponed_start_time:t.postponed_start_time||null,postponed_door_time:t.postponed_door_time||null,postponed_end_time:t.postponed_end_time||null,venue:n?{name:n.name,slug:n.slug,description:n.description,address:n.address,city:n.city,state:n.state,country:n.country,latitude:n.latitude,longitude:n.longitude,google_maps_url:n.google_maps_url,image:n.image,capacity:n.capacity}:null,location:n?n.city?n.name+", "+n.city:n.name:"Locatie TBA",artist:s.length?{name:s[0].name,image:s[0].image_url,image_url:s[0].image_url,slug:s[0].slug,bio:s[0].bio,social_links:s[0].social_links,verified:s[0].verified}:null,artists:s,ticket_types:i.map(function(e){var t=void 0!==e.available_quantity?e.available_quantity:void 0!==e.available?e.available:999;return{id:e.id,name:e.name,description:e.description,price:e.price,original_price:e.original_price||null,discount_percent:e.discount_percent||null,currency:e.currency||"RON",color:e.color||null,available:t,min_per_order:e.min_per_order||1,max_per_order:e.max_per_order||10,status:e.status,is_sold_out:t<=0,has_seating:e.has_seating||!1,seating_sections:e.seating_sections||[],seating_rows:e.seating_rows||[],commission:e.commission||null,is_refundable:e.is_refundable||!1}}),seating_layout:e.seating_layout||null,max_tickets_per_order:t.max_tickets_per_order||10,target_price:t.target_price||null,commission_rate:e.commission_rate||5,commission_mode:e.commission_mode||"included",taxes:e.taxes||[],organizer:e.organizer||null,has_custom_related:t.has_custom_related||!1,custom_related_event_ids:t.custom_related_event_ids||[],custom_related_events:e.custom_related_events||[],tour_name:e.tour_name||null,tour_events:e.tour_events||[],ticket_terms:e.event&&e.event.ticket_terms?e.event.ticket_terms:null}},showError(e){const t=document.getElementById(this.elements.loadingState);t.className="flex flex-col gap-8",t.innerHTML='<div class="w-full py-16 text-center"><svg class="w-16 h-16 mx-auto mb-4 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><h1 class="mb-4 text-2xl font-bold text-secondary">'+e+'</h1><a href="/" class="inline-flex items-center gap-2 px-6 py-3 font-semibold text-white transition-colors bg-primary rounded-xl hover:bg-primary-dark"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>ÃŽnapoi acasÄƒ</a></div><div id="error-recommended" class="mt-12 text-left"></div>',this.loadErrorRecommendations()},async loadErrorRecommendations(){try{const e=await AmbiletAPI.getFeaturedEvents(8),t=e?.data?.events||e?.data||[];if(!Array.isArray(t)||0===t.length)return;const n=document.getElementById("error-recommended");if(!n)return;n.innerHTML='<h2 class="mb-6 text-xl font-bold text-secondary flex items-center gap-2.5"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" stroke-width="2"/></svg>Evenimente recomandate</h2><div class="grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-4">'+AmbiletEventCard.renderMany(t.slice(0,8),{urlPrefix:"/bilete/",showPromotedBadge:!0})+"</div>"}catch(e){console.error("Failed to load recommended events:",e)}},isEventEnded(){const e=this.event;if(!e)return!1;const t=new Date,n=e.duration_mode||"single_day";if(e.end_date){const n=new Date(e.end_date);if(!isNaN(n.getTime())&&t>n)return!0}if("range"===n&&e.range_end_date){let n=e.range_end_date;e.range_end_time&&(n+="T"+e.range_end_time);const s=new Date(n);return!isNaN(s.getTime())&&t>s}if("multi_day"===n&&e.multi_slots&&e.multi_slots.length>0){const n=e.multi_slots[e.multi_slots.length-1];let s=n.date;n.end_time?s+="T"+n.end_time:n.start_time&&(s+="T"+n.start_time);const i=new Date(s);return!isNaN(i.getTime())&&t>i}const s=new Date(e.start_date||e.date);return!isNaN(s.getTime())&&t>s},applyEndedLayout(){const e=document.querySelector("#event-content .sticky-cart-wrapper");e&&(e.style.display="none");const t=document.querySelector("#event-content .lg\\:w-2\\/3");t&&(t.classList.remove("lg:w-2/3"),t.classList.add("lg:w-2/3","mx-auto"),t.style.maxWidth="800px");const n=document.getElementById("event-content");n&&(n.classList.remove("lg:flex-row"),n.classList.add("flex-col","items-center"));const s=document.getElementById("mobileTicketBtn");s&&(s.style.display="none");const i=document.getElementById("social-stats"),a=document.getElementById("venue-short-display");i&&(i.style.display="none"),a&&a.classList.remove("mb-6"),this.renderEndedBanner()},renderEndedBanner(){const e=document.getElementById("event-content");if(!e)return;const t=document.createElement("div");t.id="event-ended-banner",t.className="w-full mb-8",t.innerHTML='<div class="bg-primary text-white rounded-2xl p-6 mobile:rounded-none"><div class="flex items-center justify-center gap-3"><h2 class="text-xl font-bold">Evenimentul s-a Ã®ncheiat</h2></div><p class="mb-6 text-center">dar Ã®ncÄƒ mai gÄƒseÈ™ti bilete la:</p><div id="ended-related-events" class="grid gap-4 grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div><div id="ended-related-loading" class="py-8 text-sm text-center">Se cautÄƒ sugestii de evenimente...</div></div>',e.parentNode.insertBefore(t,e),this.loadEndedRelatedEvents()},async loadEndedRelatedEvents(){try{const e=new URLSearchParams({limit:8});this.event.category_slug&&e.append("category",this.event.category_slug);const t=await AmbiletAPI.get("/events?"+e.toString()),n=document.getElementById("ended-related-events"),s=document.getElementById("ended-related-loading");if(s&&(s.style.display="none"),t.success&&t.data?.length){const e=this.event.id,s=this.event.slug,i=t.data.filter(function(t){return t.id!==e&&t.slug!==s}).slice(0,4);i.length>0&&n?n.innerHTML=AmbiletEventCard.renderMany(i,{showCategory:!0,showPrice:!0,showVenue:!0,urlPrefix:"/bilete/"}):n&&(n.innerHTML='<p class="col-span-full text-white text-sm text-center">Nu sunt alte evenimente disponibile momentan.</p>')}else n&&(n.innerHTML='<p class="col-span-full text-white text-sm text-center">Nu sunt alte evenimente disponibile momentan.</p>')}catch(e){console.error("Failed to load ended related events:",e);const t=document.getElementById("ended-related-loading");t&&(t.textContent="Nu sunt alte evenimente disponibile momentan.")}},render(){const e=this.event;document.title=e.title+" â€” "+("undefined"!=typeof AMBILET_CONFIG?AMBILET_CONFIG.SITE_NAME:"Ambilet"),document.getElementById(this.elements.breadcrumbTitle).textContent=e.title,document.getElementById(this.elements.loadingState).classList.add("hidden"),document.getElementById(this.elements.eventContent).classList.remove("hidden"),this.eventEnded=this.isEventEnded(),this.eventEnded&&this.applyEndedLayout();const t=(window.innerWidth<768?e.posterImage||e.heroImage:e.heroImage||e.posterImage)||e.images?.[0]||"/assets/images/default-event.png";if(document.getElementById(this.elements.mainImage).src=t,document.getElementById(this.elements.mainImage).alt=e.title,this.renderBadges(e),this.renderStatusAlerts(e),this.isPreview){const e=document.getElementById(this.elements.eventTitle);e&&e.insertAdjacentHTML("beforebegin",'\n                    <div id="event-preview-banner" class="p-4 mb-6 border-l-4 border-indigo-500 bg-indigo-50 rounded-r-xl">\n                        <div class="flex items-start gap-3">\n                            <svg class="w-6 h-6 text-indigo-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>\n                            </svg>\n                            <div>\n                                <h3 class="font-bold text-indigo-800">Previzualizare</h3>\n                                <p class="mt-1 text-sm text-indigo-600">Acest eveniment nu este Ã®ncÄƒ public. Aceasta este o previzualizare.</p>\n                            </div>\n                        </div>\n                    </div>\n                ')}document.getElementById(this.elements.eventTitle).textContent=e.title,this.renderDate(e),document.getElementById(this.elements.eventTime).innerHTML='<span class="text-muted">Acces:</span> '+(e.start_time||"20:00"),document.getElementById(this.elements.eventDoors).innerHTML='<span class="text-muted">Doors:</span> '+(e.doors_time||"19:00");var n=e.venue?.name||e.location||"LocaÈ›ie TBA",s=e.venue?.city||e.city||"";document.getElementById(this.elements.venueName).textContent=s?n+", "+s:n,document.getElementById(this.elements.venueAddress).textContent=e.venue?.address||"";var i=document.getElementById(this.elements.venueLink);if(i&&(e.venue?.slug?(i.href="/locatie/"+e.venue.slug,i.style.display=""):i.style.display="none"),document.getElementById(this.elements.eventViews).textContent=this.formatCount(e.views_count||0)+" vizualizÄƒri",document.getElementById(this.elements.eventDescription).innerHTML=this.formatDescription(e.description||e.content),e.artist||e.artists?.length){var a=e.artists&&e.artists.length?e.artists:e.artist?[e.artist]:[];this.renderArtists(a)}this.renderVenue(e.venue||{name:e.location||"LocaÈ›ie TBA"}),this.seatingLayout=e.seating_layout||null,this.seatingLayout&&console.log("[EventPage] Event has seating layout:",this.seatingLayout.name),this.eventEnded||(this.ticketTypes=e.ticket_types||this.getDefaultTicketTypes(),this.renderTicketTypes()),e.ticket_terms&&this.renderTicketTerms(e.ticket_terms),e.tour_events&&e.tour_events.length>0&&this.renderTourEvents(e.tour_events,e.tour_name),this.eventEnded||this.setupLazyRelatedEvents()},renderBadges(e){const t=[];e.is_cancelled?t.push('<span class="px-3 py-1.5 bg-red-600 text-white text-xs font-bold rounded-lg uppercase">ANULAT</span>'):e.is_postponed?t.push('<span class="px-3 py-1.5 bg-orange-500 text-white text-xs font-bold rounded-lg uppercase">AMÃ‚NAT</span>'):this.eventEnded?t.push('<span class="px-3 py-1.5 bg-gray-600 text-white text-xs font-bold rounded-lg uppercase">ÃŽNCHEIAT</span>'):e.is_sold_out&&t.push('<span class="px-3 py-1.5 bg-gray-600 text-white text-xs font-bold rounded-lg uppercase">SOLD OUT</span>'),e.category&&t.push('<span class="px-3 py-1.5 bg-accent text-white text-xs font-bold rounded-lg uppercase">'+e.category+"</span>"),!e.is_popular||e.is_cancelled||e.is_postponed||e.is_sold_out||t.push('<span class="px-3 py-1.5 bg-primary text-white text-xs font-bold rounded-lg uppercase">Popular</span>'),document.getElementById(this.elements.eventBadges).innerHTML=t.join("")},renderStatusAlerts(e){const t=document.getElementById("event-status-alert");t&&t.remove();let n="";if(e.is_cancelled)n=`\n                <div id="event-status-alert" class="p-4 mb-6 border-l-4 border-red-500 bg-red-50 rounded-r-xl">\n                    <div class="flex items-start gap-3">\n                        <svg class="w-6 h-6 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>\n                        </svg>\n                        <div>\n                            <h3 class="font-bold text-red-800">Eveniment anulat</h3>\n                            ${e.cancel_reason?'<p class="mt-1 text-sm text-red-700">'+e.cancel_reason+"</p>":""}\n                            <p class="mt-2 text-sm text-red-600">Biletele nu mai sunt disponibile pentru acest eveniment.</p>\n                        </div>\n                    </div>\n                </div>\n            `;else if(e.is_postponed){const t=["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"];let s="";if(e.postponed_date){const n=new Date(e.postponed_date);s=n.getDate()+" "+t[n.getMonth()]+" "+n.getFullYear(),e.postponed_start_time&&(s+=" la ora "+e.postponed_start_time)}n=`\n                <div id="event-status-alert" class="p-4 mb-6 border-l-4 border-orange-500 bg-orange-50 rounded-r-xl">\n                    <div class="flex items-start gap-3">\n                        <svg class="w-6 h-6 text-orange-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>\n                        </svg>\n                        <div>\n                            <h3 class="font-bold text-orange-800">Eveniment amÃ¢nat</h3>\n                            ${e.postponed_reason?'<p class="mt-1 text-sm text-orange-700">'+e.postponed_reason+"</p>":""}\n                            ${s?'<p class="mt-2 text-sm font-semibold text-orange-800">Noua datÄƒ: '+s+"</p>":'<p class="mt-2 text-sm text-orange-600">Noua datÄƒ va fi anunÈ›atÄƒ Ã®n curÃ¢nd.</p>'}\n                        </div>\n                    </div>\n                </div>\n            `}else e.is_sold_out&&(n='\n                <div id="event-status-alert" class="p-4 mb-6 border-l-4 border-gray-500 bg-gray-50 rounded-r-xl">\n                    <div class="flex items-start gap-3">\n                        <svg class="w-6 h-6 text-gray-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>\n                        </svg>\n                        <div>\n                            <h3 class="font-bold text-gray-800">Sold Out</h3>\n                            <p class="mt-1 text-sm text-gray-600">Toate biletele pentru acest eveniment au fost vÃ¢ndute.</p>\n                        </div>\n                    </div>\n                </div>\n            ');if(n){const e=document.getElementById(this.elements.eventTitle);e&&e.insertAdjacentHTML("beforebegin",n)}},renderDate(e){const t=["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"],n=["Duminica","Luni","Marti","Miercuri","Joi","Vineri","Sambata"],s=e.duration_mode||"single_day";if("range"===s&&e.range_start_date&&e.range_end_date){const n=new Date(e.range_start_date),s=new Date(e.range_end_date);document.getElementById(this.elements.eventDay).textContent=n.getDate()+"-"+s.getDate(),document.getElementById(this.elements.eventMonth).textContent=t[n.getMonth()],document.getElementById(this.elements.eventWeekday).textContent="Festival";let i=n.getDate()+" "+t[n.getMonth()];n.getMonth(),s.getMonth(),i+=" - "+s.getDate()+" "+t[s.getMonth()]+" "+s.getFullYear(),document.getElementById(this.elements.eventDateFull).textContent=i}else if("multi_day"===s&&e.multi_slots&&e.multi_slots.length>0){const s=e.multi_slots[0],i=new Date(s.date);if(1===e.multi_slots.length)document.getElementById(this.elements.eventDay).textContent=i.getDate(),document.getElementById(this.elements.eventMonth).textContent=t[i.getMonth()],document.getElementById(this.elements.eventWeekday).textContent=n[i.getDay()],document.getElementById(this.elements.eventDateFull).textContent=i.getDate()+" "+t[i.getMonth()]+" "+i.getFullYear();else{document.getElementById(this.elements.eventDay).textContent=e.multi_slots.length,document.getElementById(this.elements.eventMonth).textContent="zile",document.getElementById(this.elements.eventWeekday).textContent="Mai multe date";const n=e.multi_slots.map(function(e){const n=new Date(e.date);return n.getDate()+" "+t[n.getMonth()]}).join(", ");document.getElementById(this.elements.eventDateFull).textContent=n}}else{const s=new Date(e.start_date||e.date);document.getElementById(this.elements.eventDay).textContent=s.getDate(),document.getElementById(this.elements.eventMonth).textContent=t[s.getMonth()],document.getElementById(this.elements.eventWeekday).textContent=n[s.getDay()],document.getElementById(this.elements.eventDateFull).textContent=s.getDate()+" "+t[s.getMonth()]+" "+s.getFullYear()}},formatDescription(e){if(!e)return'<p class="text-muted">Descriere indisponibilÄƒ</p>';if(/<[a-z][\s\S]*>/i.test(e))return'<div class="space-y-2 prose prose-slate prose-p:text-muted prose-p:leading-relaxed prose-headings:text-secondary prose-strong:text-secondary prose-a:text-primary prose-li:text-muted max-w-none">'+e+"</div>";var t=e.split(/\n\n+/).filter(function(e){return e.trim()});return 1===t.length&&(t=e.split(/\n/).filter(function(e){return e.trim()})),t.map(function(e){return'<p class="mb-4 leading-relaxed text-muted">'+e.trim()+"</p>"}).join("")},renderArtists(e){if(e&&e.length){document.getElementById(this.elements.artistSection).style.display="block";for(var t={facebook:'<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>',instagram:'<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>',tiktok:'<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>',youtube:'<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>',spotify:'<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>',website:'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>'},n={facebook:"hover:text-[#1877F2]",instagram:"hover:text-[#E4405F]",tiktok:"hover:text-black",youtube:"hover:text-[#FF0000]",spotify:"hover:text-[#1DB954]",website:"hover:text-primary"},s="",i=0;i<e.length;i++){var a=e[i];if(a){var o=a.image_url||a.image||"/assets/images/default-artist.png",r=a.slug?"/artist/"+a.slug:"#",l=a.bio||a.description||"",d=!0===a.is_headliner,c=!0===a.is_co_headliner,m="";d?m='<span class="inline-flex items-center gap-1 px-3 py-1 text-xs font-bold text-white rounded-full bg-gradient-to-r from-amber-500 to-amber-600 shadow-sm"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>HEADLINER</span>':c&&(m='<span class="inline-flex items-center gap-1 px-3 py-1 text-xs font-bold rounded-full bg-secondary/10 text-secondary"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>CO-HEADLINER</span>');var u="",p=a.social_links||{};if(Object.keys(p).length>0){for(var g in u='<div class="flex items-center gap-3">',p)p.hasOwnProperty(g)&&t[g]&&(u+='<a href="'+p[g]+'" target="_blank" rel="noopener noreferrer" class="p-2 text-muted transition-colors rounded-full bg-surface '+(n[g]||"hover:text-primary")+'" title="'+g.charAt(0).toUpperCase()+g.slice(1)+'">'+t[g]+"</a>");u+="</div>"}var v=d?"md:w-3/5":"md:w-3/4",h=d?"text-2xl":"text-xl";s+='<div class="flex flex-col gap-6 md:flex-row '+(d?"p-4 -m-4 rounded-2xl bg-gradient-to-r from-amber-50 to-transparent border border-amber-100":"")+(i>0?" pt-6 mt-6"+(d?"":" border-t border-border"):"")+'"><div class="'+(d?"md:w-2/5":"md:w-1/4")+'"><a href="'+r+'" class="relative block"><img src="'+o+'" alt="'+a.name+'" class="object-cover w-full transition-transform aspect-square rounded-2xl hover:scale-105 mobile:h-40" loading="lazy" width="300" height="300">'+(d?'<div class="absolute px-2 py-1 text-xs font-bold text-white rounded-lg shadow-lg top-3 left-3 bg-gradient-to-r from-amber-500 to-amber-600">â˜… HEADLINER</div>':"")+'</a></div><div class="'+v+'"><div class="flex flex-wrap items-center gap-3 mb-2 mobile:justify-between"><a href="'+r+'" class="'+h+' font-bold text-secondary hover:text-primary">'+a.name+"</a>"+m+(a.verified?'<span class="px-3 py-1 text-xs font-bold rounded-full bg-primary/10 text-primary">Verified</span>':"")+"</div>"+(l?'<p class="mb-2 leading-relaxed text-muted">'+l+"</p>":'<p class="mb-4 leading-relaxed text-muted">Detalii despre artist vor fi disponibile Ã®n curÃ¢nd.</p>')+'<div class="flex items-center mobile:flex-col gap-4"><a href="'+r+'" class="inline-flex mobile:flex items-center gap-2 font-semibold text-primary border border-primary rounded-md py-2 px-6 mobile:justify-center hover:bg-primary hover:text-white transition-all ease-in-out duration-200">Vezi profilul artistului<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg></a>'+u+"</div></div></div>"}}document.getElementById(this.elements.artistContent).innerHTML=s}},renderVenue(e){var t=e.google_maps_url||null;!t&&e.latitude&&e.longitude&&(t="https://www.google.com/maps/search/?api=1&query="+e.latitude+","+e.longitude);var n=e.address||"";e.city&&(n=n?n+", "+e.city:e.city),e.state&&e.state!==e.city&&(n=n?n+", "+e.state:e.state);var s='<div class="flex flex-col md:items-center gap-6 md:flex-row px-8 mobile:px-0"><div class="md:w-1/4"><img src="'+(e.image||"/assets/images/default-venue.png")+'" alt="'+e.name+'" class="object-cover w-full h-32 mb-4 rounded-2xl" loading="lazy" width="300" height="128"></div><div class="md:w-3/4"><h3 class="mb-2 text-xl font-bold text-secondary">'+e.name+'</h3><p class="mb-2 text-muted">'+n+'</p><div class="leading-relaxed text-muted text-sm">'+(e.description||"")+"</div>";e.amenities&&e.amenities.length&&(s+='<div class="mt-4 mb-6 space-y-3">',e.amenities.forEach(function(e){s+='<div class="flex items-center gap-3"><div class="flex items-center justify-center w-10 h-10 rounded-lg bg-success/10"><svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></div><span class="text-sm text-secondary">'+e+"</span></div>"}),s+="</div>"),t&&(s+='<a href="'+t+'" target="_blank" class="inline-flex items-center gap-2 font-semibold text-secondary border border-secondary text-sm rounded-md mt-2 py-2 px-6 hover:bg-secondary hover:text-white transition-all ease-in-out duration-200"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>Deschide in Google Maps</a>'),s+="</div></div>",document.getElementById(this.elements.venueContent).innerHTML=s},getDefaultTicketTypes:()=>[{id:"early",name:"Early Bird",price:65,original_price:80,available:23,description:"Acces general o zi"},{id:"standard",name:"Standard",price:80,available:245,description:"Acces general o zi"},{id:"vip",name:"VIP",price:150,available:12,description:"Acces ambele zile + Loc rezervat"},{id:"premium",name:"Premium",price:250,available:5,description:"Toate beneficiile VIP + Backstage"}],renderTicketTypes(){const e=document.getElementById(this.elements.ticketTypes);var t=this,n=this.event.target_price?parseFloat(this.event.target_price):null,s=this.event.is_cancelled||!1,i=this.event.is_postponed||!1,a=this.event.is_sold_out||!1,o=s||i||a;e.innerHTML=this.ticketTypes.map(function(e){t.quantities[e.id]=0;const r=o||e.is_sold_out||e.available<=0;var l=e.price,d=n&&l<n,c=e.original_price&&e.original_price>e.price,m=!1,u=0,p=null;d?(m=!0,p=n,u=Math.round(100*(1-l/n))):c&&(m=!0,p=e.original_price,u=Math.round(100*(1-l/p))),console.log("[EventPage] Rendering ticket:",e.name,"displayPrice:",l.toFixed(2),"targetPrice:",n,"hasTargetDiscount:",d,"hasTicketDiscount:",c,"crossedOutPrice:",p,"discountPercent:",u+"%");let g="";g=s?'<span class="text-xs font-semibold text-red-500">Eveniment anulat</span>':i?'<span class="text-xs font-semibold text-orange-500">Eveniment amÃ¢nat</span>':a?'<span class="text-xs font-semibold text-gray-500">Sold Out</span>':r?'<span class="text-xs font-semibold text-gray-400">Indisponibil</span>':e.available<=1?'<span class="text-xs font-semibold text-primary">ðŸ”¥ Ultimul bilet</span>':e.available<=5?'<span class="text-xs font-semibold text-primary">ðŸ”¥ Ultimele '+e.available+" disponibile</span>":e.available<=20?'<span class="text-xs font-semibold text-accent">ðŸ”¥ Doar '+e.available+" disponibile</span>":e.available<40?'<span class="text-xs font-semibold text-success">âš¡ '+e.available+" disponibile</span>":'<span class="text-xs font-semibold text-success"></span>';var v,h,f,x=t.calculateTicketCommission(e,e.price),y="";y="fixed"===x.type?x.fixed.toFixed(2)+" lei":"both"===x.type?x.rate+"% + "+x.fixed.toFixed(2)+" lei":x.rate+"%","included"===x.mode?(v="fixed"===x.type?e.price-x.fixed:"both"===x.type?(e.price-x.fixed)/(1+x.rate/100):e.price/(1+x.rate/100),h=e.price-v,f=e.price):(v=e.price,h=x.amount,f=e.price+h);var b='<p class="mb-2 text-sm font-semibold">Detalii pret bilet:</p><div class="space-y-1 text-xs">';"included"===x.mode?b+='<div class="flex justify-between"><span class="text-white/70">Pret bilet:</span><span>'+v.toFixed(2)+' lei</span></div><div class="flex justify-between"><span class="text-white/70">Taxe procesare ('+y+"):</span><span>"+h.toFixed(2)+' lei</span></div><div class="flex justify-between pt-1 mt-1 border-t border-white/20"><span class="font-semibold">Total:</span><span class="font-semibold">'+f.toFixed(2)+" lei</span></div>":b+='<div class="flex justify-between"><span class="text-white/70">Pret bilet:</span><span>'+e.price.toFixed(2)+' lei</span></div><div class="flex justify-between"><span class="text-white/70">Taxe procesare ('+y+"):</span><span>+"+h.toFixed(2)+' lei</span></div><div class="flex justify-between pt-1 mt-1 border-t border-white/20"><span class="font-semibold">Total la plata:</span><span class="font-semibold">'+f.toFixed(2)+" lei</span></div>",b+="</div>";var w=r?"relative z-10 p-2 pl-4 border ticket-card border-gray-200 rounded-lg bg-gray-100 cursor-default":"bg-white relative z-10 p-2 pl-4 border cursor-pointer ticket-card border-border rounded-lg hover:z-20",_=r?"text-gray-400":"text-secondary",k=r?"text-gray-400 line-through":"text-primary",E=r?"text-gray-400":"text-muted",T="",S=e.has_seating&&t.seatingLayout,M=t.quantities[e.id]||0,I=t.selectedSeats[e.id]?.length||0;if(s)T='<span class="text-sm font-medium text-red-400">Indisponibil</span>';else if(i)T='<span class="text-sm font-medium text-orange-400">ÃŽn aÈ™teptare</span>';else if(a)T='<span class="text-sm font-medium text-gray-500">Sold Out</span>';else if(r)T='<span class="text-sm font-medium text-gray-400">Epuizat</span>';else{if(T='<div class="flex items-center gap-2"><button onclick="EventPage.updateQuantity(\''+e.id+'\', -1)" class="flex items-center justify-center w-8 h-8 font-bold transition-colors rounded-lg bg-surface hover:bg-primary border border-slate-200 hover:text-white">-</button><span id="qty-'+e.id+'" class="w-8 font-bold text-center">'+M+"</span><button onclick=\"EventPage.updateQuantity('"+e.id+'\', 1)" class="flex items-center justify-center w-8 h-8 font-bold transition-colors rounded-lg bg-surface hover:bg-primary border border-slate-200 hover:text-white">+</button>',S&&M>0){var C=1===M?"Alege locul":"Alege locurile";I>0&&(C=I+" loc"+(I>1?"uri":"")+" selectat"+(I>1?"e":"")),T+="<button onclick=\"EventPage.openSeatSelection('"+e.id+'\')" class="flex items-center gap-2 px-3 py-2 ml-2 text-xs font-semibold transition-colors rounded-lg '+(I>0?"bg-green-500 text-white":"bg-accent text-white hover:bg-accent/80")+'"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>'+C+"</button>"}T+="</div>"}return'<div class="'+w+'" data-ticket="'+e.id+'" data-price="'+l+'"><div class="flex items-center justify-between"><div class="relative tooltip-trigger"><h3 class="flex items-center font-bold gap-x-2 '+_+' cursor-help border-muted">'+e.name+(m&&!r?'<span class="discount-badge text-white text-[10px] font-bold py-1 px-2 rounded-full">-'+u+"%</span>":"")+'</h3><p class="text-sm '+E+'">'+(e.description||"")+"</p>"+(r?"":'<div class="absolute left-0 z-10 w-64 p-4 mt-2 text-white shadow-xl tooltip top-full bg-secondary rounded-xl">'+b+"</div>")+'</div><div class="text-right relative">'+(m&&!r?'<span class="bg-primary p-1 px-3 rounded-md absolute -right-4 -top-6 line-through font-bold text-xs text-white">'+p.toFixed(0)+" lei</span>":"")+'<span class="block text-xl font-bold '+k+'">'+l.toFixed(2)+' lei</span></div></div><div class="flex items-end justify-between">'+g+T+"</div></div>"}).join("")},updateQuantity(e,t){const n=this.ticketTypes.find(function(t){return String(t.id)===String(e)});if(!n)return;const s=this.quantities[e]||0;let i=s+t;const a=n.min_per_order||1,o=Math.min(n.max_per_order||10,n.available);if(t>0){if(i>o)return void("undefined"!=typeof AmbiletNotifications&&AmbiletNotifications.warning("Maxim "+o+" bilete de acest tip per comandÄƒ"));0===s&&i<a&&(i=a)}else t<0&&(i>0&&i<a&&(i=0),i<0&&(i=0));if(i>n.available&&(i=n.available),i!==s){this.quantities[e]=i,document.getElementById("qty-"+e).textContent=i;const t=document.querySelector('[data-ticket="'+e+'"]');t&&t.classList.toggle("selected",i>0),this.updateCart()}},updateCart(){const e=Object.values(this.quantities).reduce(function(e,t){return e+t},0);let t=0,n=0;var s=[];for(var i in this.quantities){var a=this.quantities[i];if(!(a<=0)){var o=this.ticketTypes.find(function(e){return String(e.id)===String(i)});if(o){var r=o.price,l=this.calculateTicketCommission(o,r),d=0;"added_on_top"===l.mode&&(d=l.amount),t+=a*r,n+=a*d,s.push({name:o.name,qty:a,basePrice:r,lineTotal:a*r,commission:l})}}}const c=t+n,m=c,u=Math.floor(m/10);this.updateHeaderCart();const p=document.getElementById(this.elements.cartSummary),g=document.getElementById(this.elements.emptyCart);if(e>0){p.classList.remove("hidden"),g.classList.add("hidden"),document.getElementById(this.elements.subtotal).textContent=c.toFixed(2)+" lei";var v=document.getElementById(this.elements.taxesContainer);if(v){var h="";s.forEach(function(e){h+='<div class="flex justify-between text-sm"><span class="text-muted">'+e.qty+"x "+e.name+'</span><span class="font-medium">'+e.lineTotal.toFixed(2)+" lei</span></div>"}),n>0&&(h+='<div class="flex justify-between text-sm pt-2 mt-2 border-t border-border"><span class="text-muted">Taxe procesare</span><span class="font-medium">'+n.toFixed(2)+" lei</span></div>"),v.innerHTML=h}document.getElementById(this.elements.totalPrice).textContent=m.toFixed(2)+" lei";const e=document.getElementById(this.elements.pointsEarned);e.innerHTML=u+" puncte",e.classList.remove("points-counter"),e.offsetWidth,e.classList.add("points-counter"),this.updateCheckoutButton()}else p.classList.add("hidden"),g.classList.remove("hidden")},getSeatingTicketsNeedingSelection(){var e=[];for(var t in this.quantities){var n=this.quantities[t];if(!(n<=0)){var s=this.ticketTypes.find(function(e){return String(e.id)===String(t)});if(s&&s.has_seating&&this.seatingLayout){var i=(this.selectedSeats[t]||[]).length;i<n&&e.push({ticketType:s,required:n,selected:i})}}}return e},updateCheckoutButton(){var e=document.getElementById("checkoutBtnText"),t=document.getElementById("checkoutBtnIcon");if(e){var n=this.getSeatingTicketsNeedingSelection();if(n.length>0){var s=n.reduce(function(e,t){return e+(t.required-t.selected)},0);e.textContent=1===s?"Alege locul":"Alege locurile",t&&(t.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>')}else e.textContent="Cumpara bilete",t&&(t.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/>')}},handleCheckout(){var e=this.getSeatingTicketsNeedingSelection();e.length>0?this.openSeatSelection(e[0].ticketType.id):this.addToCart()},addToCart(){var e=!1,t=this,n=this.event.commission_rate||5,s=this.event.commission_mode||"included";for(var i in console.log("[EventPage] addToCart called"),console.log("[EventPage] Event taxes to add:",t.event.taxes),this.quantities){var a=this.quantities[i];if(a>0){var o=this.ticketTypes.find(function(e){return String(e.id)===String(i)});if(o){var r=t.event.target_price?parseFloat(t.event.target_price):null,l={id:t.event.id,title:t.event.title,slug:t.event.slug,start_date:t.event.start_date||t.event.date,start_time:t.event.start_time,image:t.event.image,venue:t.event.venue,taxes:t.event.taxes||[],target_price:r,commission_rate:n,commission_mode:s};console.log("[EventPage] eventData for cart:",l);var d=o.price,c=o.original_price;r&&d<r&&(c=r);var m={id:o.id,name:o.name,price:d,original_price:c,description:o.description,min_per_order:o.min_per_order||1,max_per_order:o.max_per_order||10,commission:o.commission||null,is_refundable:o.is_refundable||!1};AmbiletCart.addItem(t.event.id,l,o.id,m,a),e=!0}}}e&&setTimeout(function(){window.location.href="/cos"},300)},setupLazyRelatedEvents(){var e=this,t=document.getElementById("related-events-sentinel");if(t)if("IntersectionObserver"in window){var n=new IntersectionObserver(function(t){t[0].isIntersecting&&(n.disconnect(),e.loadRelatedEvents())},{rootMargin:"400px"});n.observe(t)}else this.loadRelatedEvents();else this.loadRelatedEvents()},async loadRelatedEvents(){try{this.event.has_custom_related&&this.event.custom_related_events?.length&&this.renderCustomRelatedEvents(this.event.custom_related_events);const e=new URLSearchParams({limit:8});this.event.category_slug&&e.append("category",this.event.category_slug);const t=await AmbiletAPI.get("/events?"+e.toString());if(t.success&&t.data?.length){const e=this.event.id,n=this.event.slug,s=(this.event.custom_related_event_ids||[]).map(e=>parseInt(e)),i=t.data.filter(function(t){return t.id!==e&&t.slug!==n&&!s.includes(t.id)}).slice(0,4);i.length>0&&this.renderRelatedEvents(i)}}catch(e){console.error("Failed to load related events:",e)}},renderCustomRelatedEvents(e){if(!e||0===e.length)return;const t=document.getElementById(this.elements.customRelatedSection),n=document.getElementById(this.elements.customRelatedEvents);if(t&&n){t.style.display="block";var s=this;n.innerHTML=e.map(function(e){return s.renderPremiumEventCard(e)}).join("")}},renderPremiumEventCard(e){var t=e.starts_at||e.date,n=t?new Date(t):new Date,s=n.getDate(),i=["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],a=(n.getDay(),n.getFullYear(),e.image||e.image_url||"/assets/images/default-event.png"),o=e.name||e.title||"Eveniment",r=e.slug||"",l=e.venue_name||(e.venue?e.venue.name:""),d=e.venue_city||(e.venue?e.venue.city:""),c=d?l?l+", "+d:d:l,m=e.category?.name||e.category||"",u=e.price_from?e.price_from:null;function p(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}return'<a href="/bilete/'+r+'" class="group relative block overflow-hidden bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2"><div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 bg-gradient-to-t from-primary/20 via-transparent to-transparent pointer-events-none"></div><div class="relative h-52 overflow-hidden"><img src="'+a+'" alt="'+p(o)+'" class="object-cover w-full h-full transition-transform duration-700 group-hover:scale-110" loading="lazy" width="400" height="208"><div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"></div>'+(m?'<div class="absolute top-3 left-3"><span class="px-3 py-1 text-[10px] font-bold text-white uppercase bg-secondary/80 backdrop-blur-sm rounded-full">'+p(m)+"</span></div>":"")+'<div class="absolute bottom-3 right-3"><div class="px-3 py-2 text-center bg-white/95 backdrop-blur-sm rounded-xl shadow-lg"><span class="block text-2xl font-black text-secondary leading-none">'+s+'</span><span class="block text-[10px] font-bold text-primary uppercase tracking-wide">'+i+'</span></div></div></div><div class="relative p-5"><h3 class="mb-2 text-lg font-bold leading-tight text-secondary line-clamp-2 group-hover:text-primary transition-colors">'+p(o)+"</h3>"+(c?'<p class="flex items-center gap-2 mb-3 text-sm text-muted"><svg class="flex-shrink-0 w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg><span class="truncate">'+p(c)+"</span></p>":"")+'<div class="flex items-center justify-between pt-3 mt-auto border-t border-border/50">'+(u?'<div><span class="block text-xs text-muted">De la</span><span class="text-xl font-black text-primary">'+u+' <span class="text-sm font-semibold">lei</span></span></div>':'<span class="text-sm font-medium text-muted">Vezi detalii</span>')+'<div class="flex items-center justify-center w-10 h-10 transition-all duration-300 rounded-full bg-primary/10 group-hover:bg-primary group-hover:scale-110"><svg class="w-5 h-5 text-primary group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg></div></div></div></a>'},renderTicketTerms(e){var t=document.getElementById("ticket-terms-section"),n=document.getElementById("ticket-terms-content");if(t&&n&&e){n.innerHTML=e,t.style.display="block";var s=document.getElementById("drawer-ticket-terms-section"),i=document.getElementById("drawer-ticket-terms-content");s&&i&&(i.innerHTML=e,s.style.display="block")}},toggleTicketTerms(){var e=document.getElementById("ticket-terms-content"),t=document.getElementById("ticket-terms-chevron");if(e){var n=e.classList.contains("hidden");e.classList.toggle("hidden",!n),t&&(t.style.transform=n?"rotate(180deg)":"")}},renderTourEvents(e,t){var n=document.getElementById("tour-events-section"),s=document.getElementById("tour-events-list");if(n&&s&&e&&0!==e.length){var i=document.getElementById("tour-name-display"),a=document.getElementById("tour-name-fallback");t&&i&&(i.textContent=t,a&&(a.style.display="none"));for(var o=["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Noi","Dec"],r="",l=0;l<e.length;l++){var d=e[l],c=d.event_date?new Date(d.event_date):null,m=c?c.getDate():"",u=c?o[c.getMonth()]:"",p=(c&&c.getFullYear(),d.start_time&&d.start_time.substring(0,5),d.city||""),g=d.venue_name||"",v=p?g||p:g,h=d.image_url||"/assets/images/default-event.png";r+='<a href="'+("/bilete/"+(d.slug||d.id))+'" class="flex items-center gap-4 p-3 transition-colors rounded-xl hover:bg-gray-50 group">',r+='<div class="flex-shrink-0 flex flex-col items-center justify-center w-14 h-14 rounded-xl text-white text-center" style="background: linear-gradient(135deg, #A51C30 0%, #8B1728 100%);">',r+='<span class="text-xl font-bold leading-none">'+m+"</span>",r+='<span class="text-xs font-semibold uppercase">'+u+"</span>",r+="</div>",r+='<div class="flex-shrink-0 w-16 h-12 rounded-lg overflow-hidden hidden sm:block">',r+='<img src="'+h+'" alt="'+d.name+'" class="w-full h-full object-cover" width="64" height="48">',r+="</div>",r+='<div class="flex-1 min-w-0">',v&&(r+='<p class="font-semibold text-secondary truncate group-hover:text-primary transition-colors">',r+=p||"",r+='<svg class="text-primary inline w-3.5 h-3.5 ml-1 mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>',r+='<span class="text-primary">'+v+"</span></p>"),r+='<p class="text-sm text-muted">'+(d.name||"Eveniment")+"</p>",r+="</div>",r+='<svg class="flex-shrink-0 w-5 h-5 text-gray-300 group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>',r+="</a>"}s.innerHTML=r,n.style.display="block"}},renderRelatedEvents(e){document.getElementById(this.elements.relatedEventsSection).style.display="block";var t=this.event.category,n=this.event.category_slug,s=document.getElementById(this.elements.seeAllLink);if(t&&n)document.getElementById(this.elements.relatedCategoryText).textContent="Evenimente similare din categoria "+t,s.href="/evenimente?categorie="+encodeURIComponent(n);else if(t){document.getElementById(this.elements.relatedCategoryText).textContent="Evenimente similare din categoria "+t;var i=t.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");s.href="/evenimente?categorie="+encodeURIComponent(i)}else document.getElementById(this.elements.relatedCategoryText).textContent="Evenimente similare",s.href="/evenimente";document.getElementById(this.elements.relatedEvents).innerHTML=AmbiletEventCard.renderMany(e,{showCategory:!0,showPrice:!0,showVenue:!0,urlPrefix:"/bilete/"})},updateHeaderCart(){const e="undefined"!=typeof AmbiletCart?AmbiletCart.getItemCount():0,t=document.getElementById(this.elements.cartBadge),n=document.getElementById(this.elements.cartDrawerCount);t&&(e>0?(t.textContent=e>99?"99+":e,t.classList.remove("hidden"),t.classList.add("flex")):(t.classList.add("hidden"),t.classList.remove("flex"))),n&&(e>0?(n.textContent=e,n.classList.remove("hidden")):n.classList.add("hidden"))},buildSectionToTicketTypeMap(){var e={};return this.ticketTypes.forEach(function(t){t.seating_sections&&t.seating_sections.length>0&&t.seating_sections.forEach(function(n){e[n.id]||(e[n.id]=[]),e[n.id].push(t)})}),e},buildRowToTicketTypeMap(){var e={},t=!1;if(this.ticketTypes.forEach(function(n){n.seating_rows&&n.seating_rows.length>0&&(t=!0,n.seating_rows.forEach(function(t){e[t.id]||(e[t.id]=[]),e[t.id].push(n)}))}),this._rowDataSource=t?"row":"section",!t&&this.seatingLayout&&this.seatingLayout.sections){console.warn("[EventPage] No row-level data found, using section-level fallback.");var n=this.buildSectionToTicketTypeMap();this.seatingLayout.sections.forEach(function(t){var s=n[t.id];s&&s.length>0&&t.rows&&t.rows.forEach(function(t,n){e[t.id]||(e[t.id]=[]);var i=n%s.length,a=[s[i]];s.forEach(function(n,s){s===i||e[t.id].some(function(e){return e.id===n.id})||a.push(n)}),a.forEach(function(n){e[t.id].some(function(e){return e.id===n.id})||e[t.id].push(n)})})})}console.log("[EventPage] Row-to-TicketType map built. Source: "+this._rowDataSource+", rows mapped: "+Object.keys(e).length);return this.ticketTypes.forEach(function(t){var n=0;Object.keys(e).forEach(function(s){e[s].some(function(e){return e.id===t.id})&&n++}),console.log("[EventPage]   TT#"+t.id+' "'+t.name+'" color='+(t.color||"null")+" rows="+(t.seating_rows?t.seating_rows.length:0)+" mapped_rows="+n)}),e},openSeatSelection(e){var t=this;if(this.seatingLayout){console.log("[EventPage] Opening seat selection modal"),console.log("[EventPage] Seating layout sections:",(this.seatingLayout?.sections||[]).length),console.log("[EventPage] Ticket types from API:"),this.ticketTypes.forEach(function(e){console.log("  TT#"+e.id+' "'+e.name+'" | color='+JSON.stringify(e.color)+" | seating_rows="+(e.seating_rows?e.seating_rows.length:0)+" | seating_sections="+(e.seating_sections?e.seating_sections.length:0)+" | resolved_color="+EventPage.getTicketTypeColor(e))}),this.sectionToTicketTypeMap=this.buildSectionToTicketTypeMap(),this.rowToTicketTypeMap=this.buildRowToTicketTypeMap();var n=Object.keys(this.sectionToTicketTypeMap).map(function(e){return parseInt(e)});this.seatSelectionModal||this.createSeatSelectionModal(),this.currentTicketTypeId=e,this.selectedSeats={},this.mapZoom=1,this.mapPan={x:0,y:0},this.renderModalTicketTypes(e),this.renderSelectedTicketsPanel(),this.renderSeatingMapAllSections(n),this.updateSeatSelectionSummary(),document.getElementById("seat-selection-modal").classList.remove("hidden"),document.body.style.overflow="hidden",requestAnimationFrame(function(){requestAnimationFrame(function(){t.centerMapToContent()})})}},mapZoom:1,mapPan:{x:0,y:0},createSeatSelectionModal(){var e=this,t=document.createElement("div");t.id="seat-selection-modal",t.className="fixed inset-0 hidden",t.style.zIndex="9999",t.innerHTML='<div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="EventPage.closeSeatSelection()"></div><div class="absolute inset-0 md:inset-4 lg:inset-8 bg-white md:rounded-2xl shadow-2xl flex flex-col overflow-hidden"><div class="flex items-center justify-between px-4 md:px-6 py-3 border-b border-border"><div class="flex-1 min-w-0"><h2 class="text-base md:text-xl font-bold text-secondary truncate">Alege locurile</h2><p class="text-xs md:text-sm text-muted" id="seat-selection-subtitle">SelecteazÄƒ locurile dorite pe hartÄƒ</p></div><button onclick="EventPage.closeSeatSelection()" class="p-2 transition-colors rounded-lg hover:bg-surface flex-shrink-0"><svg class="w-6 h-6 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><div class="flex-1 flex overflow-hidden"><div class="w-48 lg:w-64 border-r border-border bg-white overflow-y-auto hidden md:block" id="seat-modal-sidebar"><div class="p-4 border-b border-border"><h3 class="font-bold text-secondary text-sm">Tipuri de bilete</h3></div><div id="seat-modal-ticket-types" class="flex-1 overflow-y-auto p-3 space-y-2"></div></div><div class="flex-1 flex flex-col bg-surface/50 overflow-hidden"><div class="flex items-center justify-between px-3 md:px-4 py-2 bg-white border-b border-border"><div class="flex items-center gap-1 md:gap-2"><button onclick="EventPage.zoomMap(-0.2)" class="p-1.5 md:p-2 rounded-lg bg-surface hover:bg-gray-200 transition-colors" title="Zoom out"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg></button><span id="zoom-level" class="text-sm font-medium text-muted w-12 text-center">100%</span><button onclick="EventPage.zoomMap(0.2)" class="p-1.5 md:p-2 rounded-lg bg-surface hover:bg-gray-200 transition-colors" title="Zoom in"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg></button><button onclick="EventPage.resetMapZoom()" class="ml-1 md:ml-2 p-1.5 md:p-2 rounded-lg bg-surface hover:bg-gray-200 transition-colors text-xs" title="Reset zoom"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg></button></div><div class="text-xs text-muted hidden md:block">Scroll pentru zoom, drag pentru panoramare</div><div class="text-xs text-muted md:hidden">CiupeÈ™te pentru zoom</div></div><div class="flex-1 overflow-hidden p-1 md:p-2 relative" id="seat-map-container"><div id="seat-map-wrapper" class="w-full h-full overflow-hidden touch-none" style="cursor: grab;"><div id="seat-map-svg" class="inline-block min-w-full min-h-full flex items-center justify-center" style="transform-origin: center center;"><div class="text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/></svg>Se Ã®ncarcÄƒ harta...</div></div></div><div class="absolute bottom-3 left-3 flex flex-wrap items-center gap-2 md:gap-4 text-[10px] md:text-sm bg-white/90 backdrop-blur-sm rounded-lg px-2 md:px-3 py-1.5 md:py-2 shadow-sm"><div class="flex items-center gap-1"><span class="w-3 h-3 md:w-4 md:h-4 rounded" style="background-color: #a51c30;"></span> Selectat</div><div class="flex items-center gap-1"><span class="w-3 h-3 md:w-4 md:h-4 rounded bg-gray-300"></span> Ocupat</div><div class="flex items-center gap-1"><span class="w-3 h-3 md:w-4 md:h-4 rounded relative" style="background-color: #D1D5DB;"><span class="absolute inset-0 flex items-center justify-center text-gray-500 font-bold" style="font-size:8px;line-height:1">&times;</span></span> Indisponibil</div></div></div></div><div class="w-64 lg:w-80 border-l border-border bg-white overflow-y-auto hidden lg:flex flex-col" id="seat-selected-sidebar"><div class="py-4 px-3 border-b border-border"><h3 class="font-bold text-secondary text-sm" id="selected-tickets-count-header">0 bilete</h3></div><div id="seat-selected-tickets" class="flex-1 overflow-y-auto p-3 space-y-2"></div><div class="p-3 border-t border-border bg-surface/30"><div class="mb-3 text-center"><span class="text-sm text-muted">Locuri selectate: </span><span id="selected-seats-count" class="font-bold text-secondary">0</span><span class="mx-2 text-muted">|</span><span class="text-sm text-muted">Total: </span><span id="selected-seats-total" class="font-bold text-primary">0 lei</span></div><div class="flex gap-2"><button onclick="EventPage.confirmSeatSelection()" class="flex-1 px-4 py-2.5 text-sm font-semibold text-white bg-primary rounded-xl hover:bg-primary-dark transition-colors">CumpÄƒrÄƒ bilete</button><button onclick="EventPage.clearAllSelections()" class="p-2.5 text-secondary border border-secondary rounded-xl opacity-50 hover:bg-red-50 hover:opacity-100 hover:border-red-600 hover:text-red-600 transition-all" title="GoleÈ™te coÈ™ul"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></div></div></div><div class="lg:hidden border-t border-border bg-white px-4 py-3 flex items-center justify-between gap-3" id="seat-mobile-bottom-bar"><div class="flex-1 min-w-0"><span class="text-sm font-bold text-secondary" id="mobile-seats-count">0 locuri</span><span class="text-sm text-muted ml-2" id="mobile-seats-total">0 lei</span></div><div class="flex gap-2 flex-shrink-0"><button onclick="EventPage.clearAllSelections()" class="p-2.5 text-muted border border-gray-200 rounded-xl hover:bg-red-50 hover:border-red-300 hover:text-red-600 transition-all" title="GoleÈ™te"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button><button onclick="EventPage.confirmSeatSelection()" class="px-5 py-2.5 text-sm font-semibold text-white bg-primary rounded-xl hover:bg-primary-dark transition-colors" id="mobile-seats-buy-btn">CumpÄƒrÄƒ bilete</button></div></div></div>',document.body.appendChild(t),this.seatSelectionModal=t;var n=document.getElementById("seat-map-wrapper");n.addEventListener("wheel",function(t){t.preventDefault();var n=t.deltaY>0?-.1:.1;e.zoomMap(n)},{passive:!1});var s,i,a,o,r=!1;n.addEventListener("mousedown",function(t){r=!0,n.style.cursor="grabbing",s=t.clientX,i=t.clientY,a=e.mapPan.x,o=e.mapPan.y}),n.addEventListener("mouseleave",function(){r=!1,n.style.cursor="grab"}),n.addEventListener("mouseup",function(){r=!1,n.style.cursor="grab"}),n.addEventListener("mousemove",function(t){if(r){t.preventDefault();var n=t.clientX-s,l=t.clientY-i;e.mapPan.x=a+n,e.mapPan.y=o+l,e.applyMapTransform()}});var l,d,c,m,u=0,p=1,g=!1;n.addEventListener("touchstart",function(t){if(2===t.touches.length){t.preventDefault();var n=t.touches[0].clientX-t.touches[1].clientX,s=t.touches[0].clientY-t.touches[1].clientY;u=Math.sqrt(n*n+s*s),p=e.mapZoom,g=!1}else 1===t.touches.length&&(g=!0,l=t.touches[0].clientX,d=t.touches[0].clientY,c=e.mapPan.x,m=e.mapPan.y)},{passive:!1}),n.addEventListener("touchmove",function(t){if(2===t.touches.length){t.preventDefault();var n=t.touches[0].clientX-t.touches[1].clientX,s=t.touches[0].clientY-t.touches[1].clientY,i=Math.sqrt(n*n+s*s);if(u>0){var a=i/u;e.mapZoom=Math.max(.5,Math.min(3,p*a)),e.applyMapTransform();var o=document.getElementById("zoom-level");o&&(o.textContent=Math.round(100*e.mapZoom)+"%")}}else if(1===t.touches.length&&g){t.preventDefault();var r=t.touches[0].clientX-l,v=t.touches[0].clientY-d;e.mapPan.x=c+r,e.mapPan.y=m+v,e.applyMapTransform()}},{passive:!1}),n.addEventListener("touchend",function(e){e.touches.length<2&&(u=0),0===e.touches.length&&(g=!1)})},applyMapTransform(){var e=document.getElementById("seat-map-svg");e&&(e.style.transform="translate("+this.mapPan.x+"px, "+this.mapPan.y+"px) scale("+this.mapZoom+")")},zoomMap(e){this.mapZoom=Math.max(.5,Math.min(3,this.mapZoom+e)),this.applyMapTransform(),document.getElementById("zoom-level").textContent=Math.round(100*this.mapZoom)+"%"},resetMapZoom(){this.mapZoom=1,this.mapPan={x:0,y:0},this.applyMapTransform(),document.getElementById("zoom-level").textContent="100%"},centerMapToContent(){var e=document.getElementById("seat-map-wrapper"),t=document.querySelector("#seat-map-svg svg");if(e&&t){var n=e.getBoundingClientRect(),s=this.seatingLayout?.canvas_width||1920,i=this.seatingLayout?.canvas_height||1080,a=n.width<768,o=a?10:40,r=a?10:40,l=n.width-o,d=n.height-r,c=Math.min(l/s,d/i),m=s*(c=Math.max(.5,Math.min(2,c))),u=i*c,p=(n.width-m)/2,g=(n.height-u)/2;this.mapZoom=c,this.mapPan={x:p,y:g},this.applyMapTransform(),document.getElementById("zoom-level").textContent=Math.round(100*c)+"%"}},renderModalTicketTypes(e){var t=document.getElementById("seat-modal-ticket-types");if(t){var n=this,s=this.ticketTypes.filter(function(e){return e.has_seating&&!e.is_sold_out}).map(function(t){var s=String(t.id)===String(e),i=n.getTicketTypeColor(t);return'<div class="p-3 rounded-xl border-2 cursor-pointer transition-all '+(s?"border-primary bg-primary/5":"border-border hover:border-primary/50")+'" onclick="EventPage.switchTicketType(\''+t.id+'\')"><div class="flex justify-between items-start mb-1"><span class="flex items-center gap-1.5 font-semibold text-secondary text-sm"><span class="w-3 h-3 rounded flex-shrink-0" style="background-color: '+i+'"></span>'+t.name+'</span><span class="font-bold text-primary">'+t.price.toFixed(0)+' lei</span></div><div class="text-xs text-muted">'+(t.description||"Acces general")+"</div></div>"}).join("");t.innerHTML=s||'<p class="text-sm text-muted">Nu existÄƒ bilete cu locuri pentru acest eveniment.</p>'}},renderSelectedTicketsPanel(){var e=this,t=document.getElementById("seat-selected-tickets"),n=document.getElementById("selected-tickets-count-header");if(t){var s=0,i="";this.ticketTypes.filter(function(e){return e.has_seating&&!e.is_sold_out}).forEach(function(t){var n=e.selectedSeats[t.id]||[];0!==n.length&&(s+=n.length,i+='<div class="mb-2"><div class="flex items-center justify-between mb-1"><span class="text-xs font-semibold text-secondary">'+t.name+'</span><span class="text-xs font-bold text-primary">'+t.price.toFixed(0)+" lei</span></div>",n.forEach(function(e,n){i+='<div class="flex items-center justify-between p-2 bg-surface rounded-lg mb-1"><div class="text-xs"><div class="font-medium text-secondary">'+e.section+'</div><div class="text-muted">RÃ¢nd '+e.row+", Loc "+e.seat+"</div></div><button onclick=\"EventPage.removeSeat('"+t.id+"', "+n+')" class="p-1 text-red-500 hover:bg-red-50 rounded transition-colors" title="È˜terge"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div>'}),i+="</div>")}),t.innerHTML=i||'<p class="text-xs text-muted text-center py-4">SelecteazÄƒ locuri pe hartÄƒ</p>',n&&(n.textContent=s+" bilet"+(1!==s?"e":""))}},removeSeat(e,t){this.selectedSeats[e]&&this.selectedSeats[e][t]&&(this.selectedSeats[e].splice(t,1),this.quantities[e]=this.selectedSeats[e].length,this.refreshSeatingMap())},clearAllSelections(){var e=this;this.ticketTypes.forEach(function(t){t.has_seating&&(e.selectedSeats[t.id]=[],e.quantities[t.id]=0)}),this.refreshSeatingMap()},switchTicketType(e){this.ticketTypes.find(function(t){return String(t.id)===String(e)})&&(this.currentTicketTypeId=e,this.renderModalTicketTypes(e))},renderDecorativeSectionSvg(e){var t=e.metadata||{},n=t.shape||"polygon",s=parseFloat(t.opacity)||.3,i=e.background_color||e.color_hex||"#10B981",a="";if("polygon"===n&&t.points){for(var o=t.points,r=e.x,l=e.y,d="",c=0;c<o.length;c+=2){d+=o[c]-r+","+(o[c+1]-l)+" "}a+='<g transform="translate('+e.x+","+e.y+')">',a+='<polygon points="'+d.trim()+'" fill="'+i+'" opacity="'+s+'" stroke="'+i+'" stroke-width="1"/>',(t.label||e.name)&&(a+='<text x="10" y="20" font-size="12" font-family="Arial" fill="#1f2937" opacity="0.8">'+(t.label||e.name)+"</text>"),a+="</g>"}else if("text"===n){var m=parseInt(t.fontSize)||16,u=t.fontFamily||"Arial",p=t.fontWeight||"normal",g=t.text||e.name||"Text",v=e.height>0?e.y+e.height/2:e.y+m;a+='<text x="'+e.x+'" y="'+v+'" dominant-baseline="central" font-size="'+m+'" font-family="'+u+'" font-weight="'+p+'" fill="'+i+'">'+g+"</text>"}else if("line"===n){var h=t.points||[0,0,100,0],f=parseInt(t.strokeWidth)||2,x=t.strokeColor||i;a+='<line x1="'+(e.x+(h[0]||0))+'" y1="'+(e.y+(h[1]||0))+'" x2="'+(e.x+(h[2]||100))+'" y2="'+(e.y+(h[3]||0))+'" stroke="'+x+'" stroke-width="'+f+'" stroke-linecap="round"/>'}return a},renderSeatingMap(e,t){var n=this,s=this.seatingLayout,i=document.getElementById("seat-map-svg");if(s&&s.sections){var a=this.ticketTypes.find(function(e){return String(e.id)===String(t)}),o=a?this.getTicketTypeColor(a):"#3B82F6",r=s.canvas_width||1920,l=s.canvas_height||1080,d='<svg viewBox="0 0 '+r+" "+l+'" class="w-full h-full" style="min-width: '+r+"px; min-height: "+l+'px;" overflow="visible" preserveAspectRatio="xMidYMid meet">';if(d+="<style>.seat-hover { transition: all 0.2s ease; }.seat-hover:hover { transform: scale(1.15); filter: brightness(1.2); }</style>",s.background_image){var c=s.background_scale||1,m=s.background_x||0,u=s.background_y||0,p=s.background_opacity||.5,g=r*c,v=l*c;d+='<image href="'+s.background_image+'" x="'+m+'" y="'+u+'" width="'+g+'" height="'+v+'" opacity="'+p+'" preserveAspectRatio="xMidYMid meet"/>'}s.sections.forEach(function(s){var i=e.includes(s.id),a=s.rotation||0,r=s.x+s.width/2,l=s.y+s.height/2;if(d+="<g"+(0!==a?' transform="rotate('+a+" "+r+" "+l+')"':"")+">","icon"===s.section_type){var c=s.metadata||{},m=c.icon_size||40,u=c.background_color||s.color_hex||"#3B82F6",p=c.icon_color||"#FFFFFF",g=s.x,v=s.y,h=m/2;if(d+='<circle cx="'+(g+h)+'" cy="'+(v+h)+'" r="'+h+'" fill="'+u+'"/>',s.icon_svg){var f=.6*m,x=(m-f)/2,y=s.icon_svg;if(-1!==y.indexOf("<svg")){var b=y.match(/viewBox="([^"]+)"/),w=b?b[1]:"0 0 512 512",_=y.match(/<g[^>]*>([\s\S]*?)<\/g>/),k=_?_[1]:"";k||(k=(_=y.match(/<svg[^>]*>([\s\S]*?)<\/svg>/))?_[1]:""),d+='<svg x="'+(g+x)+'" y="'+(v+x)+'" width="'+f+'" height="'+f+'" viewBox="'+w+'">',d+='<g fill="'+p+'">'+k.replace(/fill="[^"]*"/g,'fill="'+p+'"')+"</g>",d+="</svg>"}else d+='<svg x="'+(g+x)+'" y="'+(v+x)+'" width="'+f+'" height="'+f+'" viewBox="0 0 24 24">',d+='<path d="'+y+'" fill="'+p+'"/>',d+="</svg>"}return d+='<text x="'+(g+m/2)+'" y="'+(v+m+12)+'" text-anchor="middle" font-size="10" font-weight="500" fill="#1F2937" style="text-shadow: 0 0 3px white, 0 0 3px white;">'+(s.icon_label||s.name)+"</text>",void(d+="</g>")}if("decorative"===s.section_type)return d+=n.renderDecorativeSectionSvg(s),void(d+="</g>");var E=s.metadata||{},T=(parseInt(E.seat_size)||15)/2,S=Math.round(.85*T*10)/10,M=Math.round(.5*T*10)/10;s.rows&&s.rows.forEach(function(e){if(e.seats&&0!==e.seats.length){var a=e.seats[0];if(a){var r=s.x+a.x-T-6,l=s.y+a.y;d+='<text x="'+r+'" y="'+(l+3)+'" text-anchor="end" font-size="9" font-weight="500" fill="rgba(0,0,0,0.6)" class="pointer-events-none select-none">'+e.label+"</text>"}e.seats.forEach(function(a){var r,l,c,m,u=s.x+a.x,p=s.y+a.y,g=n.isSeatSelected(t,a.id),v=a.status||"available",h="disabled"===v||"imposibil"===a.base_status;h||"blocked"===v?(r="#D1D5DB",l="#9CA3AF",c="not-allowed",m=!1):i?g?(r="#a51c30",l="#7a141f",c="pointer",m=!0):"available"===v?(r=o,l="#fff",c="pointer",m=!0):"sold"===v||"held"===v?(r="#9CA3AF",l="#6B7280",c="not-allowed",m=!1):(r="#E5E7EB",l="#D1D5DB",c="not-allowed",m=!1):(r="#E5E7EB",l="#D1D5DB",c="not-allowed",m=!1);var f,x=m?"onclick=\"EventPage.toggleSeat('"+t+"', "+a.id+", '"+s.name.replace(/'/g,"\\'")+"', '"+e.label+"', '"+a.label+"', '"+(a.seat_uid||"")+"')\"":"";h||"blocked"===v?f="Indisponibil":(f=s.name+", RÃ¢nd "+e.label+", Loc "+a.label,i?"sold"===v?f+=" â€” vÃ¢ndut":"held"===v&&(f+=" â€” rezervat"):f+=" â€” indisponibil pentru acest bilet");var y=g?1.4*T:T,b=g?Math.round(1.2*T*10)/10:S;d+='<g class="seat-hover" '+x+' style="cursor: '+c+';"><title>'+f+'</title><circle cx="'+u+'" cy="'+p+'" r="'+y+'" fill="'+r+'" stroke="'+l+'" stroke-width="'+(g?"1.5":"0.5")+'"/>',h||"blocked"===v||(d+='<text x="'+u+'" y="'+(p+.35*y)+'" text-anchor="middle" font-size="'+b+'" font-weight="600" fill="white" class="pointer-events-none select-none">'+a.label+"</text>"),(h||"blocked"===v)&&(d+='<line x1="'+(u-M)+'" y1="'+(p-M)+'" x2="'+(u+M)+'" y2="'+(p+M)+'" stroke="#6B7280" stroke-width="1.5" stroke-linecap="round"/><line x1="'+(u+M)+'" y1="'+(p-M)+'" x2="'+(u-M)+'" y2="'+(p+M)+'" stroke="#6B7280" stroke-width="1.5" stroke-linecap="round"/>'),d+="</g>"})}}),d+="</g>"}),d+="</svg>",i.innerHTML=d,this.updateSeatSelectionSummary()}else i.innerHTML='<div class="text-center text-muted">Nu existÄƒ hartÄƒ de locuri disponibilÄƒ.</div>'},renderSeatingMapAllSections(e){var t=this,n=this.seatingLayout,s=document.getElementById("seat-map-svg");if(n&&n.sections){var i=n.canvas_width||1920,a=n.canvas_height||1080,o='<svg viewBox="0 0 '+i+" "+a+'" class="w-full h-full" style="min-width: '+i+"px; min-height: "+a+'px;" overflow="visible" preserveAspectRatio="xMidYMid meet">';if(o+="<style>.seat-hover { transition: transform 0.15s ease, filter 0.15s ease; }.seat-hover:hover { filter: brightness(1.2); }</style>",n.background_image){var r=n.background_scale||1,l=n.background_x||0,d=n.background_y||0,c=n.background_opacity||.5,m=i*r,u=a*r;o+='<image href="'+n.background_image+'" x="'+l+'" y="'+d+'" width="'+m+'" height="'+u+'" opacity="'+c+'" preserveAspectRatio="xMidYMid meet"/>'}n.sections.forEach(function(e){var n=e.rotation||0,s=e.x+e.width/2,i=e.y+e.height/2;if(o+="<g"+(0!==n?' transform="rotate('+n+" "+s+" "+i+')"':"")+">","icon"===e.section_type){var a=e.metadata||{},r=a.icon_size||40,l=a.background_color||e.color_hex||"#3B82F6",d=a.icon_color||"#FFFFFF",c=e.x,m=e.y,u=r/2;if(o+='<circle cx="'+(c+u)+'" cy="'+(m+u)+'" r="'+u+'" fill="'+l+'"/>',e.icon_svg){var p=.6*r,g=(r-p)/2,v=e.icon_svg;if(-1!==v.indexOf("<svg")){var h=v.match(/viewBox="([^"]+)"/),f=h?h[1]:"0 0 512 512",x=v.match(/<g[^>]*>([\s\S]*?)<\/g>/),y=x?x[1]:"";y||(y=(x=v.match(/<svg[^>]*>([\s\S]*?)<\/svg>/))?x[1]:""),o+='<svg x="'+(c+g)+'" y="'+(m+g)+'" width="'+p+'" height="'+p+'" viewBox="'+f+'">',o+='<g fill="'+d+'">'+y.replace(/fill="[^"]*"/g,'fill="'+d+'"')+"</g>",o+="</svg>"}else o+='<svg x="'+(c+g)+'" y="'+(m+g)+'" width="'+p+'" height="'+p+'" viewBox="0 0 24 24">',o+='<path d="'+v+'" fill="'+d+'"/>',o+="</svg>"}return o+='<text x="'+(c+r/2)+'" y="'+(m+r+12)+'" text-anchor="middle" font-size="10" font-weight="500" fill="#1F2937" style="text-shadow: 0 0 3px white, 0 0 3px white;">'+(e.icon_label||e.name)+"</text>",void(o+="</g>")}if("decorative"===e.section_type)return o+=t.renderDecorativeSectionSvg(e),void(o+="</g>");var b=e.metadata||{},w=(parseInt(b.seat_size)||15)/2,_=Math.round(.85*w*10)/10,k=Math.round(.5*w*10)/10;e.rows&&e.rows.forEach(function(n){if(n.seats&&0!==n.seats.length){var s=t.rowToTicketTypeMap[n.id]||[],i=s.length>0,a=i?t.getTicketTypeColor(s[0]):"#E5E7EB",r=n.seats[0];if(r){var l=e.x+r.x-w-6,d=e.y+r.y;o+='<text x="'+l+'" y="'+(d+3)+'" text-anchor="end" font-size="9" font-weight="500" fill="rgba(0,0,0,0.6)" class="pointer-events-none select-none">'+n.label+"</text>"}n.seats.forEach(function(r){var l,d,c,m,u=e.x+r.x,p=e.y+r.y,g=t.isSeatSelectedAny(r.id),v=r.status||"available",h="disabled"===v||"imposibil"===r.base_status;h||"blocked"===v?(l="#D1D5DB",d="#9CA3AF",c="not-allowed",m=!1):i?g?(l="#a51c30",d="#7a141f",c="pointer",m=!0):"available"===v?(l=a,d="#fff",c="pointer",m=!0):"sold"===v||"held"===v?(l="#9CA3AF",d="#6B7280",c="not-allowed",m=!1):(l="#E5E7EB",d="#D1D5DB",c="not-allowed",m=!1):(l="#E5E7EB",d="#D1D5DB",c="not-allowed",m=!1);var f,x=m?'onclick="EventPage.toggleSeatAuto('+n.id+", "+r.id+", '"+e.name.replace(/'/g,"\\'")+"', '"+n.label+"', '"+r.label+"', '"+(r.seat_uid||"")+"')\"":"";h||"blocked"===v?f="Indisponibil":(f=e.name+", RÃ¢nd "+n.label+", Loc "+r.label,1===s.length?f+=" ("+s[0].name+")":s.length>1&&(f+=" ("+s.map(function(e){return e.name}).join(" / ")+")"),i?"sold"===v?f+=" â€” vÃ¢ndut":"held"===v&&(f+=" â€” rezervat"):f="Indisponibil");var y=g?1.4*w:w,b=g?Math.round(1.2*w*10)/10:_;o+='<g class="seat-hover" '+x+' style="cursor: '+c+';"><title>'+f+'</title><circle cx="'+u+'" cy="'+p+'" r="'+y+'" fill="'+l+'" stroke="'+d+'" stroke-width="'+(g?"1.5":"0.5")+'"/>',h||"blocked"===v||(o+='<text x="'+u+'" y="'+(p+.35*y)+'" text-anchor="middle" font-size="'+b+'" font-weight="600" fill="white" class="pointer-events-none select-none">'+r.label+"</text>"),(h||"blocked"===v)&&(o+='<line x1="'+(u-k)+'" y1="'+(p-k)+'" x2="'+(u+k)+'" y2="'+(p+k)+'" stroke="#6B7280" stroke-width="1.5" stroke-linecap="round"/><line x1="'+(u+k)+'" y1="'+(p-k)+'" x2="'+(u-k)+'" y2="'+(p+k)+'" stroke="#6B7280" stroke-width="1.5" stroke-linecap="round"/>'),o+="</g>"})}}),o+="</g>"}),o+="</svg>",s.innerHTML=o,this.updateSeatSelectionSummary()}else s.innerHTML='<div class="text-center text-muted">Nu existÄƒ hartÄƒ de locuri disponibilÄƒ.</div>'},isSeatSelected(e,t){return(this.selectedSeats[e]||[]).some(function(e){return e.id===t})},isSeatSelectedAny(e){var t=this;return Object.keys(this.selectedSeats).some(function(n){return t.selectedSeats[n].some(function(t){return t.id===e})})},findTicketTypesForRow(e){return this.rowToTicketTypeMap[e]||[]},toggleSeatAuto(e,t,n,s,i,a){var o=this,r=null;if(Object.keys(this.selectedSeats).forEach(function(e){(o.selectedSeats[e]||[]).some(function(e){return e.id===t})&&(r=e)}),r){var l=this.selectedSeats[r].findIndex(function(e){return e.id===t});return l>=0&&(this.selectedSeats[r].splice(l,1),this.quantities[r]=this.selectedSeats[r].length),void this.refreshSeatingMap()}var d=this.findTicketTypesForRow(e);d&&0!==d.length?1===d.length?this.selectSeatForTicketType(d[0],t,n,s,i,a):this.showTicketTypeChooser(d,t,n,s,i,a):console.warn("[EventPage] No ticket type found for row:",e)},selectSeatForTicketType(e,t,n,s,i,a){var o=String(e.id);this.selectedSeats[o]||(this.selectedSeats[o]=[]),this.selectedSeats[o].push({id:t,seat_uid:a,section:n,row:s,seat:i}),this.quantities[o]=this.selectedSeats[o].length,console.log("[EventPage] Selected seat for",e.name,":",this.selectedSeats[o]),this.refreshSeatingMap()},showTicketTypeChooser(e,t,n,s,i,a){var o=document.getElementById("tt-chooser-popup");o&&o.remove();var r=document.createElement("div");r.id="tt-chooser-popup",r.className="fixed inset-0 z-[9999] flex items-center justify-center",r.style.background="rgba(0,0,0,0.4)";var l='<div class="bg-white rounded-xl shadow-2xl p-5 max-w-xs w-full mx-4">';l+='<div class="text-sm font-semibold text-gray-700 mb-1">Alege tipul de bilet</div>',l+='<div class="text-xs text-gray-500 mb-2">'+n+", RÃ¢nd "+s+", Loc "+i+"</div>",l+='<div class="text-xs text-blue-600 bg-blue-50 rounded-lg px-3 py-2 mb-3">Acest loc are alocate mai multe tipuri de bilete. Alege-l pe cel care È›i se potriveÈ™te.</div>';var d=this;e.forEach(function(e){var o=d.getTicketTypeColor(e),r=n.replace(/'/g,"\\'");l+='<button onclick="EventPage.chooserSelect('+e.id+", "+t+", '"+r+"', '"+s+"', '"+i+"', '"+(a||"")+'\')" class="w-full text-left px-3 py-2.5 mb-1.5 rounded-lg border border-gray-200 hover:border-gray-400 hover:bg-gray-50 flex items-center gap-3 transition-colors"><span class="w-4 h-4 rounded-full flex-shrink-0" style="background:'+o+'"></span><span class="text-sm font-medium text-gray-800">'+e.name+'</span><span class="text-xs text-gray-500 ml-auto">'+e.price.toFixed(2)+" lei</span></button>"}),l+='<button onclick="document.getElementById(\'tt-chooser-popup\').remove()" class="w-full text-center text-xs text-gray-400 mt-2 py-1 hover:text-gray-600 transition-colors">AnuleazÄƒ</button>',l+="</div>",r.innerHTML=l,r.addEventListener("click",function(e){e.target===r&&r.remove()}),document.body.appendChild(r)},chooserSelect(e,t,n,s,i,a){var o=document.getElementById("tt-chooser-popup");o&&o.remove();var r=this.ticketTypes.find(function(t){return t.id===e});r&&this.selectSeatForTicketType(r,t,n,s,i,a)},refreshSeatingMap(){var e=Object.keys(this.sectionToTicketTypeMap).map(function(e){return parseInt(e)});this.renderSeatingMapAllSections(e),this.renderSelectedTicketsPanel(),this.renderModalTicketTypes(this.currentTicketTypeId),this.updateSeatSelectionSummary()},toggleSeat(e,t,n,s,i,a){this.selectedSeats[e]||(this.selectedSeats[e]=[]);var o=this.ticketTypes.find(function(t){return String(t.id)===String(e)}),r=this.selectedSeats[e].findIndex(function(e){return e.id===t});r>=0?this.selectedSeats[e].splice(r,1):this.selectedSeats[e].push({id:t,seat_uid:a,section:n,row:s,seat:i}),this.quantities[e]=this.selectedSeats[e].length,console.log("[EventPage] Selected seats:",this.selectedSeats[e]);var l=o.seating_sections.map(function(e){return e.id});this.renderSeatingMap(l,e),this.renderModalTicketTypes(e)},updateSeatSelectionSummary(){var e=this,t=0,n=0,s=[];Object.keys(this.selectedSeats).forEach(function(i){var a=e.selectedSeats[i]||[],o=e.ticketTypes.find(function(e){return String(e.id)===String(i)}),r=o?o.price:0;t+=a.length,n+=a.length*r,a.forEach(function(e){s.push({ticketType:o?o.name:"Bilet",section:e.section,row:e.row,seat:e.seat})})});var i=document.getElementById("selected-seats-count"),a=document.getElementById("selected-seats-total");i&&(i.textContent=t),a&&(a.textContent=n.toFixed(2)+" lei");var o=document.getElementById("mobile-seats-count"),r=document.getElementById("mobile-seats-total"),l=document.getElementById("mobile-seats-buy-btn");o&&(o.textContent=t+(1===t?" loc selectat":" locuri selectate")),r&&(r.textContent=n.toFixed(2)+" lei"),l&&(l.textContent=t>0?"CumpÄƒrÄƒ bilete":"SelecteazÄƒ locuri",l.disabled=0===t,l.style.opacity=t>0?"1":"0.5");var d=document.getElementById("selected-tickets-count-header");d&&(d.textContent=t+(1===t?" bilet":" bilete"));var c=document.getElementById("seat-selection-subtitle");if(s.length>0){var m=s.map(function(e){return e.section+", rÃ¢nd "+e.row+", loc "+e.seat}).slice(0,3).join("; ");s.length>3&&(m+=" È™i Ã®ncÄƒ "+(s.length-3)+" locuri"),c.textContent="Selectate: "+m}else c.textContent="SelecteazÄƒ locurile dorite pe hartÄƒ"},closeSeatSelection(){var e=this;Object.keys(this.selectedSeats).forEach(function(t){e.quantities[t]=e.selectedSeats[t].length}),document.getElementById("seat-selection-modal").classList.add("hidden"),document.body.style.overflow="",this.renderTicketTypes(),this.updateCart(),this.updateCheckoutButton(),console.log("[EventPage] Modal closed, quantities synced:",this.quantities)},async confirmSeatSelection(){var e=this,t=0;Object.keys(this.selectedSeats).forEach(function(n){t+=e.selectedSeats[n].length}),0!==t?(Object.keys(this.selectedSeats).forEach(function(t){e.quantities[t]=e.selectedSeats[t].length}),document.getElementById("seat-selection-modal").classList.add("hidden"),document.body.style.overflow="",this.renderTicketTypes(),this.updateCart(),console.log("[EventPage] Seats confirmed, total:",t),console.log("[EventPage] Selected seats by ticket type:",this.selectedSeats),console.log("[EventPage] Quantities:",this.quantities),this.clearEventFromCart(),await this.addToCartWithSeats(),window.location.href="/cos"):alert("Te rugÄƒm sÄƒ selectezi cel puÈ›in un loc.")},clearEventFromCart(){if(this.event&&this.event.id){var e=this.event.id,t=AmbiletCart.getItems(),n=t.filter(function(t){return t.eventId!==e});n.length!==t.length&&(AmbiletCart.save(n),console.log("[EventPage] Cleared",t.length-n.length,"items for event",e))}},async addToCartWithSeats(){var e=this,t=this.event.commission_rate||5,n=this.event.commission_mode||"included",s=this.seatingLayout?.event_seating_id;console.log("[EventPage] addToCartWithSeats called"),console.log("[EventPage] Selected seats:",this.selectedSeats),console.log("[EventPage] Event seating ID:",s);for(var i=e.event.target_price?parseFloat(e.event.target_price):null,a={id:e.event.id,title:e.event.title,slug:e.event.slug,start_date:e.event.start_date||e.event.date,start_time:e.event.start_time,image:e.event.image,venue:e.event.venue,taxes:e.event.taxes||[],target_price:i,commission_rate:t,commission_mode:n},o=AmbiletCart.getCart(),r=Object.keys(this.selectedSeats),l=0;l<r.length;l++){var d=r[l],c=e.selectedSeats[d];if(c&&0!==c.length){var m=e.ticketTypes.find(function(e){return String(e.id)===String(d)});if(m){var u=m.price,p=m.original_price;i&&u<i&&(p=i);var g={id:m.id,name:m.name,price:u,original_price:p,description:m.description,is_refundable:m.is_refundable||!1},v=c.map(function(e){return e.seat_uid}).filter(function(e){return e});if(s&&v.length>0)try{console.log("[EventPage] Calling API to hold seats:",v);var h=await AmbiletAPI.post("/cart/items/with-seats",{event_id:e.event.id,ticket_type_id:m.id,event_seating_id:s,seat_uids:v,seats:c.map(function(e){return{seat_uid:e.seat_uid,section_name:e.section,row_label:e.row,seat_label:e.seat}})});if(!h.success||!h.data){var f=h.message||"Locurile selectate nu mai sunt disponibile";return console.error("[EventPage] Failed to hold seats:",f),void alert(f)}console.log("[EventPage] Seats held successfully:",h.data);var x=h.data.hold_expires_at||null,y=e.event.id+"_"+m.id;o.items=o.items.filter(function(e){return e.key!==y}),o.items.push({key:y,eventId:e.event.id,event:{id:a.id,title:a.title,slug:a.slug,date:a.start_date,time:a.start_time,image:a.image,venue:a.venue,city:a.venue?.city,taxes:a.taxes,target_price:a.target_price,commission_rate:a.commission_rate,commission_mode:a.commission_mode},ticketTypeId:m.id,ticketType:{id:g.id,name:g.name,price:g.price,originalPrice:g.original_price,description:g.description,is_refundable:g.is_refundable||!1},quantity:c.length,seats:c,seat_uids:v,event_seating_id:s,hold_expires_at:x,addedAt:(new Date).toISOString()})}catch(e){return console.error("[EventPage] API error holding seats:",e),void alert("A apÄƒrut o eroare la rezervarea locurilor. VÄƒ rugÄƒm Ã®ncercaÈ›i din nou.")}else{console.warn("[EventPage] No event_seating_id, adding to cart without API hold");y=e.event.id+"_"+m.id;o.items=o.items.filter(function(e){return e.key!==y}),o.items.push({key:y,eventId:e.event.id,event:{id:a.id,title:a.title,slug:a.slug,date:a.start_date,time:a.start_time,image:a.image,venue:a.venue,city:a.venue?.city,taxes:a.taxes,target_price:a.target_price,commission_rate:a.commission_rate,commission_mode:a.commission_mode},ticketTypeId:m.id,ticketType:{id:g.id,name:g.name,price:g.price,originalPrice:g.original_price,description:g.description,is_refundable:g.is_refundable||!1},quantity:c.length,seats:c,addedAt:(new Date).toISOString()})}}else console.warn("[EventPage] Ticket type not found:",d)}}AmbiletCart.save(o.items),"function"==typeof AmbiletCart.startReservationTimer&&AmbiletCart.startReservationTimer(),console.log("[EventPage] Cart after adding seats:",AmbiletCart.getCart())},async loadOrganizerTracking(e){try{var t=await fetch(window.AMBILET.apiUrl+"?action=tracking.organizer-scripts&organizer_id="+e),n=await t.json();if(!n.success||!n.data)return;if(n.data.head_scripts){var s=document.createElement("div");s.innerHTML=n.data.head_scripts,s.querySelectorAll("script").forEach(function(e){var t=document.createElement("script");e.src?(t.src=e.src,t.async=!0):t.textContent=e.textContent,document.head.appendChild(t)}),s.querySelectorAll("noscript").forEach(function(e){document.head.appendChild(e.cloneNode(!0))})}if(n.data.body_scripts){var i=document.createElement("div");i.innerHTML=n.data.body_scripts,i.querySelectorAll("script").forEach(function(e){var t=document.createElement("script");e.src?(t.src=e.src,t.async=!0):t.textContent=e.textContent,document.body.appendChild(t)})}console.log("[EventPage] Organizer tracking scripts loaded for organizer #"+e)}catch(e){console.warn("[EventPage] Failed to load organizer tracking:",e.message)}}};window.EventPage=EventPage;