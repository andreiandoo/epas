const GenrePage={genre:"",currentPage:1,perPage:50,totalEvents:0,hasMore:!1,filters:{},monthNames:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],elements:{grid:"eventsGrid",loadMoreSection:"loadMoreSection",loadMoreBtn:"loadMoreBtn",eventsCount:"eventsCount",artistsCount:"artistsCount",citiesCount:"citiesCount",resultsCount:"resultsCount",pageTitle:"pageTitle",pageDescription:"pageDescription",genreBreadcrumb:"genreBreadcrumb",genreBanner:"genreBanner",genreIcon:"genreIcon",parentCategoryLink:"parentCategoryLink",artistsSection:"artistsSection",artistsScroll:"artistsScroll",subgenresSection:"subgenresSection",subgenresPills:"subgenresPills",filterCity:"filterCity",filterDate:"filterDate",sortEvents:"sortEvents"},async init(e){this.genre=e||"",this.genre?(this.filters.genre=this.genre,await Promise.all([this.loadGenreInfo(),this.loadArtists(),this.loadSubgenres(),this.loadCities(),this.loadEvents()]),this.bindEvents()):window.location.href="/categorie/concerte"},async loadGenreInfo(){},async loadArtists(){const e=document.getElementById(this.elements.artistsSection);if(e)try{const t=await AmbiletAPI.get("/artists?genre="+this.genre+"&limit=6");if(t.data&&t.data.length>0){const e=document.getElementById(this.elements.artistsScroll);e&&(e.innerHTML=t.data.map(e=>this.renderArtistCard(e)).join(""));const s=document.getElementById(this.elements.artistsCount);s&&(s.textContent=t.data.length+" artisti")}else e.style.display="none"}catch(t){e.style.display="none"}},renderArtistCard(e){const t=AmbiletEventCard.escapeHtml(e.name||"Artist"),s=e.image||e.portrait||"/assets/images/default-artist.png",n=e.upcoming_events_count||e.events_count||0;return'<a href="/artist/'+(e.slug||"")+'" class="flex flex-col items-center flex-shrink-0 gap-3 p-4 artist-card bg-surface rounded-2xl hover:bg-primary/5"><img src="'+s+'" alt="'+t+'" class="object-cover w-20 h-20 rounded-full ring-4 ring-primary/20" loading="lazy" onerror="this.src=\'/assets/images/default-artist.png\'"><span class="text-sm font-semibold text-secondary">'+t+'</span><span class="text-xs text-muted">'+n+" evenimente</span></a>"},async loadSubgenres(){const e=document.getElementById(this.elements.subgenresSection);if(e)try{const t=await AmbiletAPI.get("/subgenres?genre="+this.genre);if(t.data&&t.data.length>0){const e=document.getElementById(this.elements.subgenresPills);e&&(e.innerHTML='<button class="px-4 py-2 text-sm font-medium text-white rounded-full bg-primary" data-subgenre="">Toate</button>',t.data.forEach(t=>{e.innerHTML+='<button class="px-4 py-2 text-sm font-medium transition-all border rounded-full bg-surface border-border hover:bg-primary hover:text-white hover:border-primary" data-subgenre="'+t.slug+'">'+AmbiletEventCard.escapeHtml(t.name)+"</button>"}))}else e.style.display="none"}catch(t){e.style.display="none"}},async loadCities(){try{const e=await AmbiletAPI.get("/events/cities?genre="+this.genre),t=e.data?.cities||e.data||[];if(t.length>0){const e=document.getElementById(this.elements.filterCity);e&&(e.innerHTML='<option value="">Toate orasele</option>',t.forEach(t=>{e.innerHTML+='<option value="'+(t.slug||t.name)+'">'+AmbiletEventCard.escapeHtml(t.name)+"</option>"}));const s=document.getElementById(this.elements.citiesCount);s&&(s.textContent=t.length+" orase")}}catch(e){console.warn("Failed to load cities:",e)}},async loadEvents(e=!1){const t=document.getElementById(this.elements.grid);if(t){e||(this.currentPage=1,t.innerHTML=AmbiletEventCard.renderSkeletons(8));try{const s=document.getElementById(this.elements.sortEvents),n=new URLSearchParams({page:this.currentPage,per_page:this.perPage,sort:s?.value||"date_asc"});Object.keys(this.filters).forEach(e=>{this.filters[e]&&n.append(e,this.filters[e])});const r=await AmbiletAPI.get("/events?"+n.toString());if(r.data){const s=r.data,n=r.meta||{};this.totalEvents=n.total||s.length,this.hasMore=n.current_page<n.last_page;const i=document.getElementById(this.elements.eventsCount),a=document.getElementById(this.elements.resultsCount);if(i&&(i.textContent=this.totalEvents+" evenimente"),a&&(a.textContent=this.totalEvents+" rezultate"),s.length>0){const n=this.groupEventsByMonth(s);let r="";n.forEach(e=>{r+=this.renderMonthGroup(e)}),e?t.innerHTML+=r:(t.innerHTML=r,t.classList.remove("grid","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-5"),t.classList.add("flex","flex-col","gap-10"))}else t.innerHTML=AmbiletEmptyState.noEvents({onButtonClick:()=>this.clearFilters()});const l=document.getElementById(this.elements.loadMoreSection);l&&(l.style.display=this.hasMore?"block":"none")}}catch(e){console.error("Failed to load events:",e),t.innerHTML=AmbiletEmptyState.error({onButtonClick:()=>this.loadEvents()})}}},groupEventsByMonth(e){const t={};return e.forEach(e=>{const s=e.date||e.starts_at||e.event_date;if(!s)return;const n=new Date(s),r=n.getFullYear()+"-"+String(n.getMonth()+1).padStart(2,"0"),i=this.monthNames[n.getMonth()]+" "+n.getFullYear();t[r]||(t[r]={key:r,label:i,events:[]}),t[r].events.push(e)}),Object.values(t).sort((e,t)=>e.key.localeCompare(t.key))},renderMonthGroup(e){const t=AmbiletEventCard.renderMany(e.events);return'<div class="month-group"><div class="flex items-center gap-4 mb-6"><h2 class="text-2xl font-bold text-gray-900">'+e.label+'</h2><span class="px-3 py-1 text-sm font-medium text-gray-600 bg-gray-100 rounded-full">'+e.events.length+" "+(1===e.events.length?"eveniment":"evenimente")+'</span><div class="flex-1 h-px bg-gray-200"></div></div><div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">'+t+"</div></div>"},loadMore(){this.currentPage++,AmbiletPagination.setLoadingState(!0),this.loadEvents(!0).finally(()=>{AmbiletPagination.setLoadingState(!1)})},clearFilters(){const e=document.getElementById(this.elements.filterCity),t=document.getElementById(this.elements.filterDate),s=document.getElementById(this.elements.sortEvents);e&&(e.value=""),t&&(t.value=""),s&&(s.value="date_asc"),document.querySelectorAll("#"+this.elements.subgenresPills+" button").forEach(e=>{e.classList.remove("bg-primary","text-white"),e.classList.add("bg-surface","border","border-border")});const n=document.querySelector("#"+this.elements.subgenresPills+' button[data-subgenre=""]');n&&(n.classList.remove("bg-surface","border","border-border"),n.classList.add("bg-primary","text-white")),this.filters={genre:this.genre},this.loadEvents()},bindEvents(){document.querySelectorAll("#"+this.elements.subgenresPills+" button").forEach(e=>{e.addEventListener("click",e=>{document.querySelectorAll("#"+this.elements.subgenresPills+" button").forEach(e=>{e.classList.remove("bg-primary","text-white"),e.classList.add("bg-surface","border","border-border")}),e.target.classList.remove("bg-surface","border","border-border"),e.target.classList.add("bg-primary","text-white");const t=e.target.dataset.subgenre;t?this.filters.subgenre=t:delete this.filters.subgenre,this.loadEvents()})});const e=document.getElementById(this.elements.filterCity),t=document.getElementById(this.elements.filterDate),s=document.getElementById(this.elements.sortEvents);e&&e.addEventListener("change",e=>{e.target.value?this.filters.city=e.target.value:delete this.filters.city,this.loadEvents()}),t&&t.addEventListener("change",e=>{e.target.value?this.filters.date_filter=e.target.value:delete this.filters.date_filter,this.loadEvents()}),s&&s.addEventListener("change",()=>this.loadEvents())}};window.GenrePage=GenrePage;