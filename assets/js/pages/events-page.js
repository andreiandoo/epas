const EventsPage={events:[],page:1,perPage:24,totalPages:1,view:"grid",filters:{category:"",city:"",region:"",genre:"",artist:"",price:"",date:"",sort:"date",search:""},monthNames:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],elements:{loadingState:"loadingState",eventsGrid:"eventsGrid",emptyState:"emptyState",pagination:"pagination",resultsCount:"resultsCount",activeFilters:"activeFilters",activeFilterTags:"activeFilterTags",categoryFilters:"categoryFilters",cityFilter:"cityFilter",genreFilter:"genreFilter",dateFilter:"dateFilter",priceFilter:"priceFilter",sortFilter:"sortFilter",searchInput:"searchInput",viewGrid:"viewGrid",viewList:"viewList"},init(e={}){Object.assign(this.filters,e),this.loadEvents(),this.updateActiveFilters(),this.setView(this.view)},async loadEvents(){const e=document.getElementById(this.elements.loadingState),t=document.getElementById(this.elements.eventsGrid),s=document.getElementById(this.elements.emptyState);e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),s&&s.classList.add("hidden");try{const e=new URLSearchParams({page:this.page,per_page:this.perPage});Object.entries(this.filters).forEach(([t,s])=>{s&&e.append(t,s)});const t=await AmbiletAPI.get("/events?"+e.toString());let s=null,i=null;if(!1!==t.success&&(Array.isArray(t.data)?(s=t.data,i=t.meta):t.data&&t.data.events?(s=t.data.events,i=t.data.meta):t.data&&(s=[t.data])),s&&s.length>0){this.events=s,this.totalPages=i?.last_page||1;const e=document.getElementById(this.elements.resultsCount);e&&(e.textContent=i?.total||this.events.length),this.renderEvents(),this.renderPagination()}else{const e=document.getElementById(this.elements.resultsCount);e&&(e.textContent="0"),this.showEmpty()}}catch(e){console.error("Error loading events:",e),this.showEmpty()}},groupEventsByMonth(e){const t={};e.forEach(e=>{const s=AmbiletDataTransformer.normalizeEvent(e);if(!s)return;const i=e.date||e.starts_at||e.event_date;if(!i)return;const r=new Date(i),a=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0"),l=this.monthNames[r.getMonth()]+" "+r.getFullYear();t[a]||(t[a]={key:a,label:l,events:[]}),t[a].events.push({raw:e,normalized:s})});const s=Object.values(t);return"past"===this.filters.time_scope?s.sort((e,t)=>t.key.localeCompare(e.key)):s.sort((e,t)=>e.key.localeCompare(t.key))},renderEvents(){const e=document.getElementById(this.elements.eventsGrid),t=document.getElementById(this.elements.loadingState);if(t&&t.classList.add("hidden"),!e||0===this.events.length)return void this.showEmpty();const s=this.groupEventsByMonth(this.events);if(0===s.length)return void this.showEmpty();let i="";s.forEach(e=>{i+=this.renderMonthGroup(e)}),e.innerHTML=i,e.classList.remove("hidden","grid"),e.classList.add("flex","flex-col","gap-8")},renderMonthGroup(e){const t={showPrice:"past"!==this.filters.time_scope};let s;s="list"===this.view?e.events.map(e=>AmbiletEventCard.renderHorizontal(e.raw,t)).join(""):e.events.map(e=>AmbiletEventCard.render(e.raw,t)).join("");const i="grid"===this.view?"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"flex flex-col gap-4";return'<div class="month-group"><div class="flex items-center mb-6"><h2 class="text-2xl font-bold text-slate-700">'+e.label+'</h2><span class="ml-6 px-3 py-1 text-sm font-medium text-slate-600 bg-gray-100 border border-slate-200 rounded-full">'+e.events.length+" "+(1===e.events.length?"eveniment":"evenimente")+'</span><div class="flex-1 h-px bg-slate-200"></div></div><div class="'+i+'">'+s+"</div></div>"},showEmpty(){const e=document.getElementById(this.elements.loadingState),t=document.getElementById(this.elements.eventsGrid),s=document.getElementById(this.elements.emptyState);e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),s&&s.classList.remove("hidden")},renderPagination(){AmbiletPagination.render({containerId:this.elements.pagination,currentPage:this.page,totalPages:this.totalPages,mode:"smart",onPageChange:e=>this.goToPage(e)})},goToPage(e){this.page=e,this.loadEvents(),AmbiletPagination.scrollTo(400)},applyFilters(){const e=document.getElementById(this.elements.cityFilter),t=document.getElementById(this.elements.genreFilter),s=document.getElementById(this.elements.dateFilter),i=document.getElementById(this.elements.priceFilter),r=document.getElementById(this.elements.sortFilter);e&&(this.filters.city=e.value),t&&(this.filters.genre=t.value),s&&(this.filters.date=s.value),i&&(this.filters.price=i.value),r&&(this.filters.sort=r.value),this.page=1,this.updateURL(),this.updateActiveFilters(),this.loadEvents()},setCategory(e){this.filters.category=e;document.querySelectorAll("#"+this.elements.categoryFilters+" .category-btn").forEach(t=>{(t.getAttribute("data-category")||"")===e?(t.classList.remove("bg-gray-100","text-gray-700","hover:bg-gray-200"),t.classList.add("bg-primary","text-white","hover:bg-primary")):(t.classList.remove("bg-primary","text-white","hover:bg-primary"),t.classList.add("bg-gray-100","text-gray-700","hover:bg-gray-200"))}),this.page=1,this.updateURL(),this.updateActiveFilters(),this.loadEvents()},search(){const e=document.getElementById(this.elements.searchInput);e&&(this.filters.search=e.value),this.page=1,this.updateURL(),this.loadEvents()},clearFilters(){const e=this.filters.time_scope||"";this.filters={category:"",city:"",region:"",genre:"",artist:"",price:"",date:"",sort:"date",search:""},e&&(this.filters.time_scope=e);document.querySelectorAll("#"+this.elements.categoryFilters+" .category-btn").forEach(e=>{""===(e.getAttribute("data-category")||"")?(e.classList.remove("bg-gray-100","text-gray-700","hover:bg-gray-200"),e.classList.add("bg-primary","text-white")):(e.classList.remove("bg-primary","text-white"),e.classList.add("bg-gray-100","text-gray-700","hover:bg-gray-200"))});const t=document.getElementById(this.elements.cityFilter),s=document.getElementById(this.elements.genreFilter),i=document.getElementById(this.elements.dateFilter),r=document.getElementById(this.elements.priceFilter),a=document.getElementById(this.elements.sortFilter),l=document.getElementById(this.elements.searchInput);t&&(t.value=""),s&&(s.value=""),i&&(i.value=""),r&&(r.value=""),a&&(a.value="date"),l&&(l.value="");["cityFilterMobile","genreFilterMobile","dateFilterMobile","priceFilterMobile"].forEach(e=>{const t=document.getElementById(e);t&&(t.value="")});const n=document.getElementById("sortFilterMobile");n&&(n.value="date"),"function"==typeof updateMobileFilterCount&&updateMobileFilterCount(),this.page=1,this.updateURL(),this.updateActiveFilters(),this.loadEvents()},updateURL(){const e=new URLSearchParams;this.filters.category&&e.set("categorie",this.filters.category),this.filters.city&&e.set("oras",this.filters.city),this.filters.genre&&e.set("gen",this.filters.genre),this.filters.artist&&e.set("artist",this.filters.artist),this.filters.date&&e.set("data",this.filters.date),this.filters.price&&e.set("pret",this.filters.price),this.filters.sort&&"date"!==this.filters.sort&&e.set("sortare",this.filters.sort),this.filters.search&&e.set("q",this.filters.search);const t="past"===this.filters.time_scope?"/evenimente-trecute":"/evenimente",s=e.toString()?t+"?"+e.toString():t;history.pushState({},"",s)},updateActiveFilters(){const e=document.getElementById(this.elements.activeFilters),t=document.getElementById(this.elements.activeFilterTags);if(!e||!t)return;const s=[];if(this.filters.category){const e=document.querySelector("#"+this.elements.categoryFilters+' .category-btn[data-category="'+this.filters.category+'"]'),t=e?e.textContent.trim():this.filters.category;s.push({key:"category",label:"Categorie: "+t})}this.filters.city&&s.push({key:"city",label:"Oras: "+this.filters.city}),this.filters.genre&&s.push({key:"genre",label:"Gen: "+this.filters.genre}),this.filters.artist&&s.push({key:"artist",label:"Artist: "+this.filters.artist}),this.filters.date&&s.push({key:"date",label:"Data: "+this.filters.date}),this.filters.price&&s.push({key:"price",label:"Pret: "+this.filters.price}),this.filters.search&&s.push({key:"search",label:"Cautare: "+this.filters.search}),0!==s.length?(e.style.display="flex",t.innerHTML=s.map(e=>'<span class="inline-flex items-center gap-1 px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-full">'+AmbiletEventCard.escapeHtml(e.label)+"<button onclick=\"EventsPage.removeFilter('"+e.key+'\')" aria-label="È˜terge filtrul" class="ml-1 text-gray-400 hover:text-gray-600"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></span>').join("")):e.style.display="none"},removeFilter(e){if(this.filters[e]="","category"===e)return void this.setCategory("");const t={city:this.elements.cityFilter,genre:this.elements.genreFilter,date:this.elements.dateFilter,price:this.elements.priceFilter,search:this.elements.searchInput}[e];if(t){const e=document.getElementById(t);e&&(e.value="")}this.page=1,this.updateURL(),this.updateActiveFilters(),this.loadEvents()},setView(e){this.view=e;const t=document.getElementById(this.elements.eventsGrid),s=document.getElementById(this.elements.viewGrid),i=document.getElementById(this.elements.viewList);t&&("grid"===e?(s&&(s.classList.add("bg-primary","text-white"),s.classList.remove("bg-white")),i&&(i.classList.remove("bg-primary","text-white"),i.classList.add("bg-white"))):(i&&(i.classList.add("bg-primary","text-white"),i.classList.remove("bg-white")),s&&(s.classList.remove("bg-primary","text-white"),s.classList.add("bg-white"))),this.events.length>0&&this.renderEvents())}};window.EventsPage=EventsPage;