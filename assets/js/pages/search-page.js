const SearchPage={currentQuery:"",debounceTimeout:null,debounceMs:400,minChars:2,init(e=""){this.currentQuery=e,this.bindEvents(),e&&e.length>=this.minChars&&this.performSearch(e)},bindEvents(){const e=document.getElementById("searchForm"),t=document.getElementById("searchInput");e?.addEventListener("submit",e=>{e.preventDefault();const n=t?.value.trim()||"";n.length>=this.minChars&&(this.updateUrl(n),this.performSearch(n))}),t?.addEventListener("input",e=>{const t=e.target.value.trim();this.debounceTimeout&&clearTimeout(this.debounceTimeout),t.length<this.minChars?0===t.length&&this.showEmptyQuery():this.debounceTimeout=setTimeout(()=>{this.updateUrl(t),this.performSearch(t)},this.debounceMs)})},updateUrl(e){const t=new URL(window.location);t.searchParams.set("q",e),window.history.pushState({},"",t);const n=document.getElementById("pageTitle");n&&(n.textContent=`Rezultate pentru "${e}"`)},showEmptyQuery(){document.getElementById("emptyQueryState")?.classList.remove("hidden"),document.getElementById("loadingState")?.classList.add("hidden"),document.getElementById("noResultsState")?.classList.add("hidden"),document.getElementById("resultsContent")?.classList.add("hidden"),document.getElementById("eventsCount")?.classList.add("hidden"),document.getElementById("artistsCount")?.classList.add("hidden"),document.getElementById("locationsCount")?.classList.add("hidden")},showLoading(){document.getElementById("emptyQueryState")?.classList.add("hidden"),document.getElementById("loadingState")?.classList.remove("hidden"),document.getElementById("noResultsState")?.classList.add("hidden"),document.getElementById("resultsContent")?.classList.add("hidden")},showNoResults(e){document.getElementById("emptyQueryState")?.classList.add("hidden"),document.getElementById("loadingState")?.classList.add("hidden"),document.getElementById("noResultsState")?.classList.remove("hidden"),document.getElementById("resultsContent")?.classList.add("hidden");const t=document.getElementById("noResultsQuery");t&&(t.textContent=e),document.getElementById("eventsCount")?.classList.add("hidden"),document.getElementById("artistsCount")?.classList.add("hidden"),document.getElementById("locationsCount")?.classList.add("hidden")},async performSearch(e){this.currentQuery=e,this.showLoading();try{const t=await fetch(`/api/proxy.php?action=search&q=${encodeURIComponent(e)}&limit=20`),n=await t.json();n.success&&n.data?this.renderResults(n.data):this.showNoResults(e)}catch(t){console.error("Search error:",t),this.showNoResults(e)}},renderResults(e){const t=e.events||[],n=e.artists||[],s=e.locations||[];0!==t.length+n.length+s.length?(document.getElementById("emptyQueryState")?.classList.add("hidden"),document.getElementById("loadingState")?.classList.add("hidden"),document.getElementById("noResultsState")?.classList.add("hidden"),document.getElementById("resultsContent")?.classList.remove("hidden"),this.updateSummaryBadges(t.length,n.length,s.length),this.renderEventsSection(t),this.renderArtistsSection(n),this.renderLocationsSection(s)):this.showNoResults(this.currentQuery)},updateSummaryBadges(e,t,n){const s=document.getElementById("eventsCount"),o=document.getElementById("artistsCount"),d=document.getElementById("locationsCount");s&&(e>0?(s.textContent=`${e} ${1===e?"eveniment":"evenimente"}`,s.classList.remove("hidden")):s.classList.add("hidden")),o&&(t>0?(o.textContent=`${t} ${1===t?"artist":"artiști"}`,o.classList.remove("hidden")):o.classList.add("hidden")),d&&(n>0?(d.textContent=`${n} ${1===n?"locație":"locații"}`,d.classList.remove("hidden")):d.classList.add("hidden"))},renderEventsSection(e){const t=document.getElementById("eventsSection"),n=document.getElementById("eventsGrid"),s=document.getElementById("eventsSectionCount");e.length?(t?.classList.remove("hidden"),s&&(s.textContent=e.length),n&&("undefined"!=typeof AmbiletEventCard?n.innerHTML=AmbiletEventCard.renderMany(e,{urlPrefix:"/bilete/",showCategory:!0,showPrice:!0,showVenue:!0}):n.innerHTML=e.map(e=>this.renderEventCard(e)).join(""))):t?.classList.add("hidden")},renderEventCard(e){const t=e.start_date?this.formatDate(e.start_date):"",n=e.image||e.poster_url||"https://via.placeholder.com/400x250?text=Event",s=e.min_price?`de la ${e.min_price} lei`:"",o=e.venue?.name||e.venue_name||"";return`\n            <a href="/bilete/${e.slug}" class="group block overflow-hidden bg-white border rounded-2xl border-border hover:shadow-lg transition-all">\n                <div class="relative h-48 overflow-hidden bg-gray-100">\n                    <img src="${n}" alt="${this.escapeHtml(e.title)}" class="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300" loading="lazy">\n                    ${s?`<div class="absolute bottom-3 left-3 px-3 py-1 text-sm font-semibold text-white bg-primary rounded-lg">${s}</div>`:""}\n                </div>\n                <div class="p-4">\n                    <h3 class="font-semibold text-gray-900 truncate group-hover:text-primary transition-colors">${this.escapeHtml(e.title)}</h3>\n                    <div class="mt-2 text-sm text-gray-500">\n                        ${t?`<div class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>${t}</div>`:""}\n                        ${o?`<div class="flex items-center gap-1 mt-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>${this.escapeHtml(o)}</div>`:""}\n                    </div>\n                </div>\n            </a>\n        `},renderArtistsSection(e){const t=document.getElementById("artistsSection"),n=document.getElementById("artistsGrid"),s=document.getElementById("artistsSectionCount");e.length?(t?.classList.remove("hidden"),s&&(s.textContent=e.length),n&&(n.innerHTML=e.map(e=>this.renderArtistCard(e)).join(""))):t?.classList.add("hidden")},renderArtistCard(e){const t=e.image||e.photo_url||"https://via.placeholder.com/200x200?text=Artist",n=e.genre||e.type||"";return`\n            <a href="/artist/${e.slug}" class="group block text-center p-4 bg-white border rounded-2xl border-border hover:shadow-lg transition-all">\n                <div class="relative w-24 h-24 mx-auto mb-3 overflow-hidden rounded-full bg-gray-100">\n                    <img src="${t}" alt="${this.escapeHtml(e.name)}" class="object-cover w-full h-full group-hover:scale-110 transition-transform duration-300" loading="lazy">\n                </div>\n                <h3 class="font-semibold text-gray-900 truncate group-hover:text-primary transition-colors">${this.escapeHtml(e.name)}</h3>\n                ${n?`<div class="mt-1 text-sm text-gray-500 truncate">${this.escapeHtml(n)}</div>`:""}\n            </a>\n        `},renderLocationsSection(e){const t=document.getElementById("locationsSection"),n=document.getElementById("locationsGrid"),s=document.getElementById("locationsSectionCount");e.length?(t?.classList.remove("hidden"),s&&(s.textContent=e.length),n&&(n.innerHTML=e.map(e=>this.renderLocationCard(e)).join(""))):t?.classList.add("hidden")},renderLocationCard(e){const t=e.image||"https://via.placeholder.com/400x200?text=Location",n=[e.address,e.city].filter(Boolean).join(", ");return`\n            <a href="/locatie/${e.slug}" class="group block overflow-hidden bg-white border rounded-2xl border-border hover:shadow-lg transition-all">\n                <div class="relative h-36 overflow-hidden bg-gray-100">\n                    <img src="${t}" alt="${this.escapeHtml(e.name)}" class="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300" loading="lazy">\n                </div>\n                <div class="p-4">\n                    <h3 class="font-semibold text-gray-900 truncate group-hover:text-primary transition-colors">${this.escapeHtml(e.name)}</h3>\n                    ${n?`<div class="mt-1 text-sm text-gray-500 truncate flex items-center gap-1"><svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>${this.escapeHtml(n)}</div>`:""}\n                </div>\n            </a>\n        `},formatDate(e){const t=new Date(e);return`${["Dum","Lun","Mar","Mie","Joi","Vin","Sâm"][t.getDay()]}, ${t.getDate()} ${["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]} ${t.getFullYear()}`},escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}};"undefined"!=typeof module&&module.exports&&(module.exports=SearchPage);