const HeroSlider={events:[],currentIndex:0,autoplayInterval:null,autoplayDelay:2e3,async init(){try{const e=await AmbiletAPI.get("/events/featured?type=homepage&limit=12");if(e.data&&e.data.events&&e.data.events.length>0)this.events=e.data.events,this.render(),this.renderDots(),this.updatePositions(),this.bindEvents(),this.startAutoplay();else{const e=document.getElementById("heroSlider");e&&(e.style.display="none")}}catch(e){console.warn("Failed to load hero events:",e);const t=document.getElementById("heroSlider");t&&(t.style.display="none")}},render(){const e=document.getElementById("heroCarousel");e&&0!==this.events.length&&(e.innerHTML=this.events.map((e,t)=>{const s=getStorageUrl(e.homepage_featured_image||e.featured_image||e.hero_image_url||e.image),n=this.escapeHtml(e.title||e.name||"Eveniment"),a=e.venue_city||e.city||"",i=e.venue_name||(e.venue?e.venue.name:"")||"",o=a?i?a+", "+i:a:i,r=e.price_from?"De la "+e.price_from+" Lei":"";return'<div class="hero-item" data-index="'+t+'" style="--r: '+(t-this.currentIndex)+';"><a href="/bilete/'+(e.slug||"")+'" class="hero-item-inner"><img src="'+s+'" alt="'+n+'" loading="'+(t<5?"eager":"lazy")+'"><div class="hero-item-overlay"></div><div class="hero-item-content"><h3 class="hero-item-title">'+n+'</h3><div class="hero-item-meta">'+(o?'<span class="hero-item-location"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>'+this.escapeHtml(o)+"</span>":"")+(r?'<span class="hero-item-price">'+r+"</span>":"")+"</div></div></a></div>"}).join(""))},renderDots(){const e=document.getElementById("heroDots");e&&(e.innerHTML=this.events.map((e,t)=>'<button class="hero-dot'+(0===t?" active":"")+'" data-index="'+t+'"></button>').join(""))},updatePositions(){const e=document.querySelectorAll(".hero-item"),t=this.events.length;e.forEach((e,s)=>{let n=s-this.currentIndex;n>t/2&&(n-=t),n<-t/2&&(n+=t);const a=Math.abs(n);e.style.setProperty("--r",n),e.style.setProperty("--abs",a),e.style.zIndex=10-a,e.style.opacity=a>2?0:1,e.style.filter="brightness("+(1-.15*a)+")",e.style.pointerEvents=a>2?"none":"auto"});document.querySelectorAll(".hero-dot").forEach((e,t)=>{e.classList.toggle("active",t===this.currentIndex)})},goToSlide(e){const t=this.events.length;e<0&&(e=t-1),e>=t&&(e=0),this.currentIndex=e,this.updatePositions()},next(){this.goToSlide(this.currentIndex+1)},prev(){this.goToSlide(this.currentIndex-1)},startAutoplay(){this.stopAutoplay(),this.events.length>1&&(this.autoplayInterval=setInterval(()=>this.next(),this.autoplayDelay))},stopAutoplay(){this.autoplayInterval&&(clearInterval(this.autoplayInterval),this.autoplayInterval=null)},bindEvents(){const e=document.getElementById("heroSlider"),t=document.getElementById("heroCarousel"),s=document.getElementById("heroDots");s&&s.addEventListener("click",e=>{const t=e.target.closest(".hero-dot");t&&(this.goToSlide(parseInt(t.dataset.index,10)),this.startAutoplay())}),t&&t.addEventListener("click",e=>{const t=e.target.closest(".hero-item");if(!t)return;0!==parseFloat(t.style.getPropertyValue("--r"))&&(e.preventDefault(),this.goToSlide(parseInt(t.dataset.index,10)),this.startAutoplay())}),e&&(e.addEventListener("mouseenter",()=>this.stopAutoplay()),e.addEventListener("mouseleave",()=>this.startAutoplay()));let n=0;t&&(t.addEventListener("touchstart",e=>{n=e.touches[0].clientX,this.stopAutoplay()},{passive:!0}),t.addEventListener("touchend",e=>{const t=n-e.changedTouches[0].clientX;Math.abs(t)>50&&(t>0?this.next():this.prev()),this.startAutoplay()},{passive:!0})),document.addEventListener("keydown",e=>{"ArrowLeft"===e.key?(this.prev(),this.startAutoplay()):"ArrowRight"===e.key&&(this.next(),this.startAutoplay())})},escapeHtml:e=>e?e.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])):""},CityEventsFilter={allEvents:[],cities:[],selectedCity:"",async init(){await this.loadEvents(),this.extractCitiesFromEvents(),this.renderCityButtons(),this.renderEvents()},async loadEvents(){try{const e=await AmbiletAPI.get("/marketplace-events?sort=latest&limit=30");e.data&&(this.allEvents=Array.isArray(e.data)?e.data:e.data.events||e.data.data||[])}catch(e){console.warn("Failed to load events:",e)}},extractCitiesFromEvents(){const e=new Map;this.allEvents.forEach(t=>{const s=t.venue_city||t.venue?.city||"";if(!s)return;const n=s.toLowerCase().trim();e.has(n)?e.get(n).count++:e.set(n,{name:s,slug:n.replace(/\s+/g,"-"),count:1})}),this.cities=Array.from(e.values()).sort((e,t)=>t.count-e.count).slice(0,10)},renderCityButtons(){const e=document.getElementById("cityFilterButtons");if(!e)return;const t=this.cities.map(e=>'<button class="px-4 py-2 text-sm font-semibold transition-all rounded-full city-filter-btn" data-city="'+e.name+'">'+e.name+"</button>").join("");e.innerHTML='<button class="px-4 py-2 text-sm font-semibold text-white transition-all rounded-full city-filter-btn active bg-primary" data-city="">Toate</button>'+t,e.querySelectorAll(".city-filter-btn").forEach(e=>{e.addEventListener("click",()=>this.filterByCity(e.dataset.city))})},filterByCity(e){this.selectedCity=e,document.querySelectorAll(".city-filter-btn").forEach(t=>{t.classList.toggle("active",t.dataset.city===e)}),this.renderEvents()},renderEvents(){const e=document.getElementById("cityEventsGrid");if(!e)return;let t=this.allEvents;if(this.selectedCity){const e=this.selectedCity.toLowerCase().trim();t=this.allEvents.filter(t=>(t.venue_city||t.venue?.city||"").toLowerCase().trim()===e)}t&&0!==t.length?("undefined"!=typeof AmbiletEventCard?e.innerHTML=AmbiletEventCard.renderMany(t.slice(0,25),{urlPrefix:"/bilete/",showCategory:!0,showPrice:!0,showVenue:!0}):e.innerHTML='<p class="text-muted col-span-full">Nu sunt evenimente disponibile.</p>',setTimeout(()=>{document.querySelectorAll(".reveal").forEach(e=>e.classList.add("active"))},100)):e.innerHTML='<p class="py-8 text-center text-muted col-span-full">Nu sunt evenimente disponibile pentru acest oraÈ™.</p>'}},PromotedEvents={async init(){try{const[e,t]=await Promise.all([AmbiletAPI.get("/marketplace-events?promoted=1&limit=12").catch(()=>({data:[]})),AmbiletAPI.get("/marketplace-events?recommended=1&limit=12").catch(()=>({data:[]}))]),s=this.extractEvents(e),n=this.extractEvents(t),a=[...s];n.forEach(e=>{a.find(t=>t.id===e.id)||a.push(e)});const i=a.slice(0,12);this.shuffle(i),this.render(i)}catch(e){console.warn("Failed to load promoted events:",e)}},extractEvents:e=>e&&e.data?Array.isArray(e.data)?e.data:e.data.events||e.data.data||[]:[],shuffle(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}},render(e){const t=document.getElementById("promotedEventsGrid");t&&(e&&0!==e.length?("undefined"!=typeof AmbiletEventCard&&"function"==typeof AmbiletEventCard.renderManyPromoted?t.innerHTML=AmbiletEventCard.renderManyPromoted(e):t.innerHTML='<p class="text-muted col-span-full">Nu sunt evenimente disponibile.</p>',setTimeout(()=>{document.querySelectorAll(".reveal").forEach(e=>e.classList.add("active"))},100)):t.innerHTML='<p class="text-muted col-span-full">Nu sunt evenimente disponibile.</p>')}},LazyLoader={observer:null,loadedSections:new Set,init(){this.observer=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target,s=t.dataset.lazyLoad;this.loadedSections.has(s)||(this.loadedSections.add(s),this.loadSection(s,t))}})},{rootMargin:"100px 0px",threshold:.01}),document.querySelectorAll("[data-lazy-load]").forEach(e=>{this.observer.observe(e)})},async loadSection(e,t){try{switch(e){case"categories":await loadCategories();break;case"cityEvents":await CityEventsFilter.init()}}catch(t){console.warn("Failed to load section: "+e,t)}t.classList.add("loaded"),this.observer.unobserve(t)}};async function loadCategories(){try{const e=await AmbiletAPI.getCategories();e.data&&e.data.categories&&renderCategories(e.data.categories)}catch(e){console.warn("Failed to load categories:",e)}}function renderCategories(e){var t=document.getElementById("categoriesGrid"),s={concerte:"ğŸ¸",festivaluri:"ğŸª",teatru:"ğŸ­","stand-up":"ğŸ˜‚",copii:"ğŸ‘¶",sport:"âš½",moto:"ğŸï¸",expozitii:"ğŸ–¼ï¸",conferinte:"ğŸ’¼"};e&&0!==e.length?t.innerHTML=e.slice(0,6).map(function(e){return'<a href="/'+e.slug+'" class="flex items-center gap-3 px-3 py-2 bg-white border rounded-lg category-pill border-border group"><div class="flex items-center justify-center w-8 h-8 transition-colors rounded-lg bg-primary/10 group-hover:bg-white/20"><span class="text-lg">'+(s[e.slug]||"ğŸ«")+'</span></div><span class="text-sm font-semibold transition-colors md:text-base text-secondary group-hover:text-white">'+e.name+"</span></a>"}).join(""):t.innerHTML='<p class="text-muted col-span-full">Nu sunt categorii disponibile.</p>'}document.addEventListener("DOMContentLoaded",async function(){LazyLoader.init(),await Promise.all([HeroSlider.init(),PromotedEvents.init(),FeaturedCarousel.init()])});