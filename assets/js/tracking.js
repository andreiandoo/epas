!function(e,t){"use strict";const n="epas_visitor_id",i="epas_session_id",c=18e5;let a={apiUrl:"",marketplaceClientId:null,marketplaceEventId:null,autoTrackPageViews:!0,autoTrackClicks:!1,autoTrackScroll:!1,debug:!1,batchSize:10,batchInterval:5e3},r=[],o=null,s=null,l=null,u=null;function d(){sessionStorage.setItem(i,JSON.stringify({id:l,startTime:u,lastActivity:Date.now()}))}function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function p(n,i={}){d();const c={event_type:n,marketplace_client_id:a.marketplaceClientId,marketplace_event_id:i.marketplace_event_id||a.marketplaceEventId,visitor_id:s,session_id:l,page_url:e.location.href,page_path:e.location.pathname,page_title:t.title,referrer:t.referrer,screen_width:e.screen.width,screen_height:e.screen.height,..._(),...i,timestamp:(new Date).toISOString()};r.push(c),v("Event queued:",c),["purchase","add_to_cart","begin_checkout"].includes(n)&&f()}function h(e={}){p("page_view",e)}function _(){const t=new URLSearchParams(e.location.search);return{utm_source:t.get("utm_source"),utm_medium:t.get("utm_medium"),utm_campaign:t.get("utm_campaign"),utm_term:t.get("utm_term"),utm_content:t.get("utm_content"),gclid:t.get("gclid"),fbclid:t.get("fbclid"),ttclid:t.get("ttclid")}}function f(e=!1){if(0===r.length)return;const t=r.splice(0,a.batchSize);1===t.length?function(e,t=!1){const n=`${a.apiUrl}/track`;if(t&&navigator.sendBeacon)return navigator.sendBeacon(n,JSON.stringify(e)),void v("Event sent via beacon:",e);fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e),keepalive:t}).then(e=>e.json()).then(e=>{v("Event sent successfully:",e)}).catch(t=>{console.error("[EPASTracking] Failed to send event:",t),r.unshift(e)})}(t[0],e):function(e,t=!1){const n=`${a.apiUrl}/batch`;if(t&&navigator.sendBeacon)return navigator.sendBeacon(n,JSON.stringify({events:e})),void v("Batch sent via beacon:",e.length,"events");fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({events:e}),keepalive:t}).then(e=>e.json()).then(e=>{v("Batch sent successfully:",e)}).catch(t=>{console.error("[EPASTracking] Failed to send batch:",t),r.unshift(...e)})}(t,e),r.length>0&&setTimeout(()=>f(),100)}function v(...e){a.debug&&console.log("[EPASTracking]",...e)}e.EPASTracking={init:function(r){a={...a,...r},a.apiUrl?a.marketplaceClientId?(!function(){s=localStorage.getItem(n),s||(s=g(),localStorage.setItem(n,s));const e=sessionStorage.getItem(i);if(e){const t=JSON.parse(e);Date.now()-t.lastActivity<c&&(l=t.id,u=t.startTime)}l||(l=g(),u=Date.now());d()}(),a.autoTrackPageViews&&(h(),function(){const t=history.pushState;history.pushState=function(){t.apply(history,arguments),h()};const n=history.replaceState;history.replaceState=function(){n.apply(history,arguments),h()},e.addEventListener("popstate",function(){h()})}()),a.autoTrackClicks&&t.addEventListener("click",function(e){const t=e.target.closest("a, button, [data-track-click]");if(!t)return;const n=t.dataset.trackClick;if(n)try{p("click",JSON.parse(n))}catch(e){p("click",{event_label:n})}else"A"===t.tagName&&t.href&&p("click",{event_label:t.textContent.trim().substring(0,100),content_id:t.href})},!0),a.autoTrackScroll&&function(){const n=[25,50,75,100],i=new Set;function c(){const c=e.scrollY,a=t.documentElement.scrollHeight-e.innerHeight,r=Math.round(c/a*100);for(const e of n)r>=e&&!i.has(e)&&(i.add(e),p("scroll",{event_value:e,event_label:`${e}%`}))}let a;e.addEventListener("scroll",function(){clearTimeout(a),a=setTimeout(c,100)},{passive:!0})}(),o=setInterval(f,a.batchInterval),e.addEventListener("beforeunload",function(){f(!0)}),t.addEventListener("visibilitychange",function(){"hidden"===t.visibilityState&&f(!0)}),v("Initialized with config:",a)):console.error("[EPASTracking] marketplaceClientId is required"):console.error("[EPASTracking] apiUrl is required")},track:p,trackPageView:h,trackViewItem:function(e,t,n={}){p("view_item",{marketplace_event_id:e,content_id:String(e),content_type:"event",content_name:t,...n})},trackAddToCart:function(e,t,n,i,c="RON",a={}){p("add_to_cart",{marketplace_event_id:e,content_id:String(t),content_type:"ticket",quantity:n,event_value:i*n,currency:c,...a})},trackBeginCheckout:function(e,t,n="RON",i={}){p("begin_checkout",{marketplace_event_id:e,event_value:t,currency:n,...i})},trackPurchase:function(e,t,n,i="RON",c={}){p("purchase",{marketplace_event_id:e,content_id:String(t),content_type:"order",event_value:n,currency:i,...c})},trackSignUp:function(e="email",t={}){p("sign_up",{event_label:e,...t})},trackLogin:function(e="email",t={}){p("login",{event_label:e,...t})},trackSearch:function(e,t=null,n={}){p("search",{event_label:e,event_value:t,...n})},getVisitorId:function(){return s},getSessionId:function(){return l},setMarketplaceEventId:function(e){a.marketplaceEventId=e},setDebug:function(e){a.debug=e},flush:f}}(window,document);